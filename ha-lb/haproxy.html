<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3734"/>

<div>
<span><div style="background-color: rgb(230, 230, 230); font-size: 14px;"><div style="background-color:rgb(255, 255, 255);box-shadow:rgba(100, 100, 100, 0.3) 0px 2px 6px;"><div style="text-align:left;"><div style="text-overflow: ellipsis; overflow: hidden; word-break: break-all; font-size: 14px;"><div style="text-overflow:ellipsis;overflow:hidden;word-break:break-all;"><div><h1 style="float: left; margin: 0px 0px 10px; padding: 0px 0px 0px 1px; clear: both; font-size: 150%; width: 100%; border: 0px;"><span style="font-size: 16px; min-width: 100%; position: relative;"><a href="https://www.cnblogs.com/skyflask/p/6970151.html" style="margin: 0px; padding: 0px; outline: none; transition: all 0.4s linear 0s; font-size: 150%; color: rgb(33, 117, 155); font-family: 微软雅黑, 宋体, 黑体, Arial; font-weight: bold; line-height: 1.5em; text-decoration: none;">Haproxy原理</a></span></h1></div><div style="margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px; word-break: break-word; font-size: 15px;"><blockquote style="margin: 10px 0px; background: none; border: 2px solid rgb(239, 239, 239); padding: 5px 10px; min-height: 35px;"><h4 style="padding: 0px; font-size: 14px; margin: 10px 0px;"></h4><h4><br/></h4><h4 style="padding: 0px; font-size: 14px; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.6em;">目录</span></h4><div><a href="http://www.cnblogs.com/skyflask/p/6970151.html#_caption_0" style="font-size: 15px; margin: 0px; padding: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.6em; text-decoration: underline;">一、四层和七层负载均衡的区别</a></div><div><a href="http://www.cnblogs.com/skyflask/p/6970151.html#_caption_1" style="font-size: 15px; margin: 0px; padding: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.6em; text-decoration: underline;">二、HAProxy与LVS的异同</a></div><div><strong style="margin:0px;padding:0px;"><strong style="margin:0px;padding:0px;"><a href="http://www.cnblogs.com/skyflask/p/6970151.html#_caption_2" style="font-size: 18px; margin: 0px; padding: 0px; font-weight: bold; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6em; text-decoration: underline;">三、快速安装HAProxy集群软件</a></strong></strong></div><div><a href="http://www.cnblogs.com/skyflask/p/6970151.html#_caption_3" style="font-size: 15px; margin: 0px; padding: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.6em; text-decoration: underline;">四、HAProxy基础配置文件详解</a></div><div><a href="http://www.cnblogs.com/skyflask/p/6970151.html#_caption_4" style="font-size: 15px; margin: 0px; padding: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.6em; text-decoration: underline;">五、启动与测试Haproxy的负责均衡功能</a></div><div><a href="http://www.cnblogs.com/skyflask/p/6970151.html#_caption_5" style="font-size: 15px; margin: 0px; padding: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.6em; text-decoration: underline;">六、HAProxy负载均衡器算法与使用技巧</a></div><div><a href="http://www.cnblogs.com/skyflask/p/6970151.html#_caption_6" style="font-size: 15px; margin: 0px; padding: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.6em; text-decoration: underline;">七、通过HAProxy的ACL规则实现智能负载均衡</a></div><div><a href="http://www.cnblogs.com/skyflask/p/6970151.html#_caption_7" style="font-size: 15px; margin: 0px; padding: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.6em; text-decoration: underline;">八、使用HAProxy的Web监控平台</a></div></blockquote><h2 style="border-radius: 6px; font-size: 15px; padding: 8px 0px 5px 5px; background: rgb(34, 139, 34); box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.5) 1px 1px 6px 1px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; margin: 18px 0px;"><span style="font-size: 15px; color: rgb(255, 255, 255); font-family: 微软雅黑, 宋体, 黑体, Arial; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 20px;">一、四层和七层负载均衡的区别</span></h2><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">所谓的四层就是ISO参考模型中的第四层。四层负载均衡也称为四层交换机，它主要是通过分析IP层及TCP/UDP层的流量实现的基于IP加端口的负载均衡。常见的基于四层的负载均衡器有LVS、F5等。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">以常见的TCP应用为例，负载均衡器在接收到第一个来自客户端的SYN请求时，会通过设定的负载均衡算法选择一个最佳的后端服务器，同时将报文中目标IP地址修改为后端服务器IP，然后直接转发给该后端服务器，这样一个负载均衡请求就完成了。从这个过程来看，一个TCP连接是客户端和服务器直接建立的，而负载均衡器只不过完成了一个类似路由器的转发动作。在某些负载均衡策略中，为保证后端服务器返回的报文可以正确传递给负载均衡器，在转发报文的同时可能还会对报文原来的源地址进行修改。整个过程下图所示。</span></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;"> <img src="Haproxy_files/462684-20170609080415325-588338352.png" type="image/png" data-filename="462684-20170609080415325-588338352.png" height="138" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="526"/></span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">同理，七层负载均衡器也称为七层交换机，位于OSI的最高层，即应用层，此时负载均衡器支持多种应用协议，常见的有HTTP、FTP、SMTP等。七层负载均衡器可以根据报文内容，再配合负载均衡算法来选择后端服务器，因此也称为“内容交换器”。比如，对于Web服务器的负载均衡，七层负载均衡器不但可以根据“IP+端口”的方式进行负载分流，还可以根据网站的URL、访问域名、浏览器类别、语言等决定负载均衡的策略。例如，有两台Web服务器分别对应中英文两个网站，两个域名分别是A、B，要实现访问A域名时进入中文网站，访问B域名时进入英文网站，这在四层负载均衡器中几乎是无法实现的，而七层负载均衡可以根据客户端访问域名的不同选择对应的网页进行负载均衡处理。常见的七层负载均衡器有HAproxy、Nginx等。</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">这里仍以常见的TCP应用为例，由于负载均衡器要获取到报文的内容，因此只能先代替后端服务器和客户端建立连接，接着，才能收到客户端发送过来的报文内容，然后再根据该报文中特定字段加上负载均衡器中设置的负载均衡算法来决定最终选择的内部服务器。纵观整个过程，七层负载均衡器在这种情况下类似于一个代理服务器。整个过程如下图所示。</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;"><img src="Haproxy_files/462684-20170609080434872-1191012506.png" type="image/png" data-filename="462684-20170609080434872-1191012506.png" height="141" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="550"/></span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><br style="margin:0px;padding:0px;"/></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">对比四层负载均衡和七层负载均衡运行的整个过程，可以看出，在七层负载均衡模式下，负载均衡器与客户端及后端的服务器会分别建立一次TCP连接，而在四层负载均衡模式下，仅建立一次TCP连接。由此可知，七层负载均衡对负载均衡设备的要求更高，而七层负载均衡的处理能力也必然低于四层模式的负载均衡。</span></div></div><h2 style="border-radius: 6px; font-size: 15px; padding: 8px 0px 5px 5px; background: rgb(34, 139, 34); box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.5) 1px 1px 6px 1px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; margin: 18px 0px;"><span style="font-size: 15px; color: rgb(255, 255, 255); font-family: 微软雅黑, 宋体, 黑体, Arial; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 20px;">二、HAProxy与LVS的异同</span></h2><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">通过之前文章的介绍，大家应该基本清楚了HAProxy负载均衡与LVS负载均衡的优缺点和异同了。下面就这两种负载均衡软件的异同做一个简单总结：</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">1）两者都是软件负载均衡产品，但是LVS是基于Linux操作系统实现的一种软负载均衡，而HAProxy是基于第三应用实现的软负载均衡。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">2）LVS是基于四层的IP负载均衡技术，而HAProxy是基于四层和七层技术、可提供TCP和HTTP应用的负载均衡综合解决方案。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">3）LVS工作在ISO模型的第四层，因此其状态监测功能单一，而HAProxy在状态监测方面功能强大，可支持端口、URL、脚本等多种状态检测方式。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">4）HAProxy虽然功能强大，但是整体处理性能低于四层模式的LVS负载均衡，而LVS拥有接近硬件设备的网络吞吐和连接负载能力。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">综上所述，HAProxy和LVS各有优缺点，没有好坏之分，要选择哪个作为负载均衡器，要以实际的应用环境来决定。</span></div></div><h2 style="border-radius: 6px; font-size: 15px; padding: 8px 0px 5px 5px; background: rgb(34, 139, 34); box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.5) 1px 1px 6px 1px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; margin: 18px 0px;"><strong style="margin:0px;padding:0px;"><span style="margin: 0px; padding: 0px; font-size: 18px; font-weight: bold; color: rgb(255, 255, 255); font-family: 微软雅黑, 宋体, 黑体, Arial; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 20px;">三、快速安装HAProxy集群软件</span></strong></h2><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">yum install haproxy</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">文件存放位置：</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">/usr/sbin/haproxy  #二进制文件</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">/usr/share/haproxy  #共享文件</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">/var/lib/haproxy  #库文件</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">/etc/rc.d/init.d/haproxy  #启动二进制文件</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">/etc/logrotate.d/haproxy  #日志切割</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">/etc/sysconfig/haproxy   #配置</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">/etc/haproxy  #配置目录</span></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">安装完成后，默认安装目录中没有配置文件，这里是将源码包里面的示例配置文件拷贝到配置文件目录</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">这样，HAProxy就安装完成了。</span></div></div><h2 style="border-radius: 6px; font-size: 15px; padding: 8px 0px 5px 5px; background: rgb(34, 139, 34); box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.5) 1px 1px 6px 1px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; margin: 18px 0px;"><span style="font-size: 15px; color: rgb(255, 255, 255); font-family: 微软雅黑, 宋体, 黑体, Arial; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 20px;">四、HAProxy基础配置文件详解</span></h2><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">HAProxy配置文件根据功能和用途，主要有5个部分组成，但有些部分并不是必须的，可以根据需要选择相应的部分进行配置。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（1）global部分</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">用来设定全局配置参数，属于进程级的配置，通常和操作系统配置有关。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（2）defaults部分</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">默认参数的配置部分。在此部分设置的参数值，默认会自动被引用到下面的frontend、backend和listen部分中，因此，如果某些参数属于公用的配置，只需在defaults部分添加一次即可。而如果在frontend、backend和listen部分中也配置了与defaults部分一样的参数，那么defaults部分参数对应的值自动被覆盖。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（3）frontend部分</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">此部分用于设置接收用户请求的前端虚拟节点。frontend是在HAProxy1.3版本之后才引入的一个组件，同时引入的还有backend组件。通过引入这些组件，在很大程度上简化了HAProxy配置文件的复杂性。frontend可以根据ACL规则直接指定要使用的后端backend。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（4）backend部分</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">此部分用于设置集群后端服务集群的配置，也就是用来添加一组真实服务器，以处理前端用户的请求。添加的真实服务器类似于LVS中的real server节点。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（5）listen部分</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">此部分是frontend部分和backend部分的结合体。在HAProxy1.3版本之前，HAProxy的所有配置选项都在这个部分中设置。为了保持兼容性，HAProxy新的版本仍然保留了listen组件的配置方式。目前在HAProxy中，两种配置方式任选其一即可。</span></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">下面是一个完整的HAProxy配置文件</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><span style="margin:0px;padding:0px;font-size:18px;"><span style="font-size: 18px; margin: 0px; padding: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5em;">global</span></span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">log 127.0.0.1 local0 info</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">maxconn 4096</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">user nobody</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">group nobody</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">daemon</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">nbproc 1</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">pidfile /usr/local/haproxy/logs/haproxy.pid</span></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><br style="margin:0px;padding:0px;"/></div><div><strong style="margin:0px;padding:0px;"><span style="margin: 0px; padding: 0px; font-size: 18px; font-weight: bold; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5em;">defaults</span></strong></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">mode http</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">retries 3</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">timeout connect 10s</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">timeout client 20s</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">timeout server 30s</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">timeout check 5s</span></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><br style="margin:0px;padding:0px;"/></div><div><span style="margin:0px;padding:0px;font-size:18px;"><span style="font-size: 18px; margin: 0px; padding: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5em;">frontend www</span></span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">bind *:80</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">mode http</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">option httplog</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">option forwardfor</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">option httpclose</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">log global</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">#acl host_www hdr_dom(host) -i www.zb.com</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">#acl host_img hdr_dom(host) -i img.zb.com</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">#use_backend htmpool if host_www</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">#use_backend imgpool if host_img</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">default_backend htmpool</span></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><br style="margin:0px;padding:0px;"/></div><div><strong style="margin:0px;padding:0px;"><span style="margin: 0px; padding: 0px; font-size: 18px; font-weight: bold; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5em;">backend htmpool</span></strong></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">mode http</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">option redispatch</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">option abortonclose</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">balance static-rr</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">cookie SERVERID</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">option httpchk GET /index.jsp</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">server 237server 192.168.81.237:8080 cookie server1 weight 6 check inter 2000 rise 2 fall 3</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">server iivey234 192.168.81.234:8080 cookie server2 weight 3 check inter 2000 rise 2 fall 3</span></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><br style="margin:0px;padding:0px;"/></div><div><strong style="margin:0px;padding:0px;"><span style="margin: 0px; padding: 0px; font-size: 18px; font-weight: bold; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5em;">backend imgpool</span></strong></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">mode http</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">option redispatch</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">option abortonclose</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">balance static-rr</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">cookie SERVERID</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">option httpchk GET /index.jsp</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">server host236 192.168.81.236:8080 cookie server1 weight 6 check inter 2000 rise 2 fall 3</span></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><br style="margin:0px;padding:0px;"/></div><div><strong style="margin:0px;padding:0px;"><span style="margin: 0px; padding: 0px; font-size: 18px; font-weight: bold; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5em;">listen admin_stats</span></strong></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">bind 0.0.0.0:9188</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">mode http</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">log 127.0.0.1 local0 err</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">stats refresh 30s</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">stats uri /haproxy-status</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">stats realm welcome login\ Haproxy</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">stats auth admin:admin~!@</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">stats hide-version</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">stats admin if TRUE</span></div></div><h2 style="border-radius: 6px; font-size: 15px; padding: 8px 0px 5px 5px; background: rgb(34, 139, 34); box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.5) 1px 1px 6px 1px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; margin: 18px 0px;"><span style="font-size: 15px; color: rgb(255, 255, 255); font-family: 微软雅黑, 宋体, 黑体, Arial; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 20px;">五、启动与测试Haproxy的负责均衡功能</span></h2><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">service haproxy</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">Usage: /etc/init.d/haproxy {start|stop|status|restart|try-restart|reload|force-reload}</span></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">启动haproxy</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">service haproxy start</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">停止haproxy</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">service haproxy stop</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">平滑重启</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">service haproxy reload</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;"> </span></div><h2 style="border-radius: 6px; font-size: 15px; padding: 8px 0px 5px 5px; background: rgb(34, 139, 34); box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.5) 1px 1px 6px 1px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; margin: 18px 0px;"><span style="font-size: 15px; color: rgb(255, 255, 255); font-family: 微软雅黑, 宋体, 黑体, Arial; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 20px;">六、HAProxy负载均衡器算法与使用技巧</span></h2><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">1、HAProxy支持的负载均衡算法</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（1）、roundrobin，表示简单的轮询，负载均衡基础算法</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（2）、static-rr，表示根据权重</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（3）、leastconn，表示最少连接者先处理</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（4）、source，表示根据请求源IP</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（5）、uri，表示根据请求的URI；</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（6）、url_param，表示根据请求的URl参数来进行调度</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（7）、hdr(name)，表示根据HTTP请求头来锁定每一次HTTP请求；</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（8）、rdp-cookie(name)，表示根据据cookie(name)来锁定并哈希每一次TCP请求。</span></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">2、常用的负载均衡算法</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（1）轮询算法：roundrobin</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（2）根据请求源IP算法：source</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">（3）最少连接者先处理算法：lestconn</span></div></div><h2 style="border-radius: 6px; font-size: 15px; padding: 8px 0px 5px 5px; background: rgb(34, 139, 34); box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.5) 1px 1px 6px 1px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; margin: 18px 0px;"><span style="font-size: 15px; color: rgb(255, 255, 255); font-family: 微软雅黑, 宋体, 黑体, Arial; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 20px;">七、通过HAProxy的ACL规则实现智能负载均衡</span></h2><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">由于HAProxy可以工作在七层模型下， 因此，要实现HAProxy的强大功能，一定要使用强大灵活的ACL规则，通过ACL规则可以实现基于HAProxy的智能负载均衡系统。HAProxy通过ACL规则完成两种主要的功能，分别是：</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">1）通过设置的ACL规则检查客户端请求是否合法。如果符合ACL规则要求，那么就将放行，反正，如果不符合规则，则直接中断请求。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">2）符合ACL规则要求的请求将被提交到后端的backend服务器集群，进而实现基于ACL规则的负载均衡。</span></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">HAProxy中的ACL规则经常使用在frontend段中，使用方法如下：</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">1acl 自定义的acl名称 acl方法 -i [匹配的路径或文件]</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">其中：</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">acl：是一个关键字，表示定义ACL规则的开始。后面需要跟上自定义的ACL名称 。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">acl方法:这个字段用来定义实现ACL的方法，HAProxy定义了很多ACL方法，经常使用的方法有hdr_reg(host)、hdr_dom(host)、hdr_beg(host)、url_sub、url_dir、path_beg、path_end等。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">-i：表示忽略大小写，后面需要跟上匹配的路径或文件或正则表达式。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">与ACL规则一起使用的HAProxy参数还有use_backend，use_backend后面需要跟上一个backend实例名，表示在满足ACL规则后去请求哪个backend实例，与use_backend对应的还有default_backend参数，它表示在没有满足ACL条件的时候默认使用哪个后端backend。</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">下面列举几个常见的ACL规则例子：</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">acl www_policy hdr_reg(host) -i ^(www.z.cn|z.cn)</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">acl bbs_policy hdr_dom(host) -i bbs.z.cn</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">acl url_policy url_sub -i buy_sid=</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">use_backend server_www if www_policy</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">use_backend server_app if url_policy</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">use_backend server_bbs if bbs_policy</span></div><div><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">default_backend server_cache</span></div></div><h2 style="border-radius: 6px; font-size: 15px; padding: 8px 0px 5px 5px; background: rgb(34, 139, 34); box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.5) 1px 1px 6px 1px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; margin: 18px 0px;"><span style="font-size: 15px; color: rgb(255, 255, 255); font-family: 微软雅黑, 宋体, 黑体, Arial; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 20px;">八、使用HAProxy的Web监控平台</span></h2><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;">HAProxy虽然实现了服务的故障转移，但是在主机或者服务出现故障的时候，并不能发出通知告知运维人员，这对于及时性要求很高的业务系统来说，是非常不便的，不过，HAProxy似乎也考虑到了这一点，在新的版本中HAProxy推出了一个基于Web的监控平台，通过这个平台可以查看此集群系统所有后端服务器的运行状态，在后端服务或服务器出现故障时，监控页面会通过不同的颜色来展示故障信息，这在很大程度上解决了后端服务器故障报警的问题，运维人员可通过监控这个页面来第一时间发现节点故障，进而修复故障。</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;"> <img src="Haproxy_files/462684-20170609081748387-1580067076.png" type="image/png" data-filename="462684-20170609081748387-1580067076.png" height="437" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="900"/></span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#/usr/local/sbin/haproxy -f /etc/haproxy/haproxy.cfg -st `cat /var/run/haproxy.pid` </span></span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       ####################</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">全局配置信息</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">######################## </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       #######</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">参数是进程级的，通常和操作系统（OS）相关</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">######### </span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">global</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">maxconn</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">20480</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#默认最大连接数</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">log</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">127.0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">0.1</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">local3 #[err warning</span> <span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">info</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">debug]</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">chroot</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/var/</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">haproxy #chroot运行的路径</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">uid</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">99</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#所属运行的用户uid</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">gid</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">99</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#所属运行的用户组</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">daemon #以后台形式运行haproxy</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">nbproc</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#进程数量(可以设置多个进程提高性能)</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">pidfile</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/var/run/</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">haproxy.pid #haproxy的pid存放路径,启动进程的用户必须有权限访问此文件</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">ulimit</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-n</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">65535</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#ulimit的数量限制</span></div></div><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       #####################</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">默认的全局设置</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">###################### </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       ##</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">这些参数可以被利用配置到frontend，backend，listen组件</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">## </span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">defaults</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">log global</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">mode http #所处理的类别 (#7层 http;4层tcp )</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">maxconn</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">20480</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#最大连接数</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option httplog #日志类别http日志格式</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option httpclose #每次请求完毕后主动关闭http通道</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option dontlognull #不记录健康检查的日志信息</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option forwardfor #如果后端服务器需要获得客户端真实ip需要配置的参数，可以从Http Header中获得客户端ip</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option redispatch #serverId对应的服务器挂掉后,强制定向到其他健康的服务器</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option abortonclose #当服务器负载很高的时候，自动结束掉当前队列处理比较久的连接</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">stats refresh</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">30</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#统计页面刷新间隔</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">retries</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#3次连接失败就认为服务不可用，也可以通过后面设置</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">balance roundrobin #默认的负载均衡的方式,轮询方式</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#balance source #默认的负载均衡的方式,类似nginx的ip_hash</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#balance leastconn #默认的负载均衡的方式,最小连接</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">contimeout</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">5000</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#连接超时</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">clitimeout</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">50000</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#客户端超时</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">srvtimeout</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">50000</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#服务器超时</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">timeout check</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">2000</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#心跳检测超时</span></div></div><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       ####################</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">监控页面的设置</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">####################### </span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">listen admin_status #Frontend和Backend的组合体,监控组的名称，按需自定义名称</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">bind</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">0.0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">0.0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">65532</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#监听端口</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">mode http #http的7层模式</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">log</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">127.0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">0.1</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">local3 err #错误日志记录</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">stats refresh 5s #每隔5秒自动刷新监控页面</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">stats uri</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/admin?</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">stats #监控页面的url</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">stats realm xuequn\ xuequn #监控页面的提示信息</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">stats auth admin:admin #监控页面的用户和密码admin,可以设置多个用户名</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">stats auth admin1:admin1 #监控页面的用户和密码admin1</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">stats hide</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">version #隐藏统计页面上的HAproxy版本信息</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">stats admin</span> <span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">if</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">TRUE #手工启用/禁用,后端服务器(haproxy-</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1.4</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.9以后版本)</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">errorfile</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">403</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/etc/haproxy/errorfiles/</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">403</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.http</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">errorfile</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">500</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/etc/haproxy/errorfiles/</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">500</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.http</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">errorfile</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">502</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/etc/haproxy/errorfiles/</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">502</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.http</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">errorfile</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">503</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/etc/haproxy/errorfiles/</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">503</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.http</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">errorfile</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">504</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/etc/haproxy/errorfiles/</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">504</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.http</span></div></div><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       #################</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">HAProxy的日志记录内容设置</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">################### </span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">capture request header Host len</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">40</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">capture request header Content</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-Length len</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">10</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">capture request header Referer len</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">200</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">capture response header Server len</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">40</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">capture response header Content</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-Length len</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">10</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">capture response header Cache</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-Control len</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">8</span></div></div><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       #######################</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">网站监测listen配置</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">##################### </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       ###########</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">此用法主要是监控haproxy后端服务器的监控状态</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">############ </span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">listen site_status</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">bind</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">0.0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">0.0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1081</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#监听端口</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">mode http #http的7层模式</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">log</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">127.0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">0.1</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">local3 err #[err warning</span> <span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">info</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">debug]</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">monitor</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-uri /</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">site_status #网站健康检测URL，用来检测HAProxy管理的网站是否可以用，正常返回200，不正常返回503</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">acl site_dead nbsrv(server_web) lt</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">2</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#定义网站down时的策略当挂在负载均衡上的指定backend的中有效机器数小于1台时返回true</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">acl site_dead nbsrv(server_blog) lt</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">2</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">acl site_dead nbsrv(server_bbs) lt</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">2</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">monitor fail</span> <span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">if</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">site_dead #当满足策略的时候返回503，网上文档说的是500，实际测试为503</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">monitor</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-net</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">192.168</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">16.2</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">32</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#来自192.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">168.16</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.2的日志信息不会被记录和转发</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">monitor</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-net</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">192.168</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">16.3</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">32</span></div></div><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       ########</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">frontend配置</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">############ </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       #####</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">注意，frontend配置里面可以定义多个acl进行匹配操作</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">######## </span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">frontend http_80_in</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">bind</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">0.0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">0.0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">80</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#监听端口，即haproxy提供web服务的端口，和lvs的vip端口类似</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">mode http #http的7层模式</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">log global #应用全局的日志配置</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option httplog #启用http的log</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option httpclose #每次请求完毕后主动关闭http通道，HA</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-Proxy不支持keep-</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">alive模式</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option forwardfor #如果后端服务器需要获得客户端的真实IP需要配置次参数，将可以从Http Header中获得客户端IP</span></div></div><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">########</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">acl策略配置</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">############# </span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">acl xuequn_web hdr_reg(host) -i ^(<a href="http://www.xuequn.cn/">www.xuequn.cn</a>|ww1.xuequn.cn)$ #如果请求的域名满足正则表达式中的2个域名返回true -</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">i是忽略大小写</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">acl xuequn_blog hdr_dom(host)</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-i blog.xuequn.cn #如果请求的域名满足<a href="http://www.xuequn.cn/">www.xuequn.cn</a>返回true -</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">i是忽略大小写</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#acl xuequn hdr(host)</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-i xuequn.cn #如果请求的域名满足xuequn.cn返回true -</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">i是忽略大小写</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#acl file_req url_sub</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-i</span> <span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">killall</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#在请求url中包含killall=</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">，则此控制策略返回true,否则为false</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#acl dir_req url_dir</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">i allow #在请求url中存在allow作为部分地址路径，则此控制策略返回true,否则返回false</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#acl missing_cl hdr_cnt(Content</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">-length) eq</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">0</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#当请求的header中Content-length等于0时返回true</span></div></div><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       ########</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">acl策略匹配相应</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">############# </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">      </span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#block</span> <span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">if</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">missing_cl #当请求中header中Content-</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">length等于0阻止请求返回403</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#block</span> <span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">if</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">!file_req ||</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">dir_req #block表示阻止请求，返回403错误，当前表示如果不满足策略file_req，或者满足策略dir_req，则阻止请求</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">use_backend server_web</span> <span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">if</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">xuequn_web #当满足xuequn_web的策略时使用server_web的backend</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">use_backend server_blog</span> <span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">if</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">xuequn_blog #当满足xuequn_blog的策略时使用server_blog的backend</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#redirect prefix http://192.168.16.3</span> <span style="font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">code 301 if xuequn #当访问xuequn.cn的时候，用http的301挑转到http:</span><span style="font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">//</span><span style="font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">192.168.16.3</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">default_backend server_bbs #以上都不满足的时候使用默认server_bbs的backend</span></div></div><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">       ##########</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">backend的设置</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">############## </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">下面我将设置三组服务器 server_web，server_blog，server_bbs</span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">###########################</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">backend server_web</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">############################# </span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">backend server_web</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">mode http #http的7层模式</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">balance roundrobin #负载均衡的方式，roundrobin平均方式</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">cookie SERVERID #允许插入serverid到cookie中，serverid后面可以定义</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option httpchk GET</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">index.html #心跳检测的文件</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">server web1</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">192.168</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">16.2</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">80</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">cookie web1 check inter</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1500</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">rise</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">fall</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">weight</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#服务器定义，cookie 1表示serverid为web1，check inter 1500是检测心跳频率rise 3是3次正确认为服务器可用，</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#fall 3是3次失败认为服务器不可用，weight代表权重</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">server web2</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">192.168</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">16.3</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">80</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">cookie web2 check inter</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1500</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">rise</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">fall</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">weight</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">2</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#服务器定义，cookie 1表示serverid为web2，check inter 1500是检测心跳频率rise 3是3次正确认为服务器可用，</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#fall 3是3次失败认为服务器不可用，weight代表权重</span></div></div><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">###################################</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">backend server_blog</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">############################################### </span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">backend server_blog</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">mode http #http的7层模式</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">balance roundrobin #负载均衡的方式，roundrobin平均方式</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">cookie SERVERID #允许插入serverid到cookie中，serverid后面可以定义</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option httpchk GET</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">index.html #心跳检测的文件</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">server blog1</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">192.168</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">16.2</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">80</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">cookie blog1 check inter</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1500</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">rise</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">fall</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">weight</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#服务器定义，cookie 1表示serverid为web1，check inter 1500是检测心跳频率rise 3是3次正确认为服务器可用，fall 3是3次失败认为服务器不可用，weight代表权重</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">server blog2</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">192.168</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">16.3</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">80</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">cookie blog2 check inter</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1500</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">rise</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">fall</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">weight</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">2</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#服务器定义，cookie 1表示serverid为web2，check inter 1500是检测心跳频率rise 3是3次正确认为服务器可用，fall 3是3次失败认为服务器不可用，weight代表权重</span></div></div><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">###################################</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">backend server_bbs</span><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">############################################### </span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-size: 12px;"><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div><div style="margin: 0px; padding: 0px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">backend server_bbs</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">mode http #http的7层模式</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">balance roundrobin #负载均衡的方式，roundrobin平均方式</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">cookie SERVERID #允许插入serverid到cookie中，serverid后面可以定义</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">option httpchk GET</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">/</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">index.html #心跳检测的文件</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">server bbs1</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">192.168</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">16.2</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">80</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">cookie bbs1 check inter</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1500</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">rise</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">fall</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">weight</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#服务器定义，cookie 1表示serverid为web1，check inter 1500是检测心跳频率rise 3是3次正确认为服务器可用，fall 3是3次失败认为服务器不可用，weight代表权重</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">server bbs2</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">192.168</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">16.3</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">80</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">cookie bbs2 check inter</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">1500</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">rise</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">fall</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">3</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">weight</span> <span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">2</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; line-height: 1.5; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;">#服务器定义，cookie 1表示serverid为web2，check inter 1500是检测心跳频率rise 3是3次正确认为服务器可用，fall 3是3次失败认为服务器不可用，weight代表权重</span></div></div><div style="margin: 0px; padding: 0px; margin-top: 5px; background-color: rgb(245, 245, 245);"><a href="#" style="font-size: 11pt;"><img style="margin:0px;padding:0px;height:auto;max-width:300px;border:none;background-color:rgb(245, 245, 245);" width="64"></img></a></div></div><div style="padding: 0px; font-size: 14px; margin: 10px auto; text-indent: 0px;"><span style="font-size: 14px; text-indent: 0px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; line-height: 1.5em; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="font-size: 14px; color: black; font-family: 微软雅黑, PTSans, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.5em;"><br/></span></div></div></div></div></div></div></div></div><div><br/></div></span>
</div></body></html> 