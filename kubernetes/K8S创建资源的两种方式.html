<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600240 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="890"/>

<div>
<span><div style="-evernote-webclip:true;"><div style="letter-spacing: 0.034em; background-color: rgb(255, 255, 255);"><div style="overflow-wrap:break-word;hyphens:auto;"><div style="background-color:rgb(255, 255, 255);"><div style="overflow: hidden; overflow-wrap: break-word; text-align: justify;"><div style="font-size: 17px; margin: 1em auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-width: initial; border-color: initial; border-style: none; text-align: center; width: 18em;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 18.6667px; display: inline-block; box-sizing: border-box; letter-spacing: 0.442px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(0, 88, 156); color: rgb(255, 255, 255); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-webclip:true;">第5篇</span><span style="font-size: 16pt; display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-webclip:true;">K8S<span style="font-size: 16pt; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">创建资源的两种方式</span></span></div></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 20px;"><span style="font-size: 20px; font-weight: bold; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">一、创建方式分类：</span></span></strong></div><div style="margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243); text-align: left;"><span style="max-width: 100%;box-sizing: border-box;overflow-wrap: break-word;-evernote-webclip:true;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 28.8px;">命令 vs 配置文件</span></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">Kubernetes 支持两种方式创建资源：</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">1.用 kubectl 命令直接创建，比如：</span></div><div style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: inherit; overflow-wrap: break-word; overflow: auto;"><span style="font-size: 12pt; color: rgb(54, 101, 238);">kubectl run httpd-app --image=</span><a href="http://reg.yunwei.edu/learn/httpd:latest" style="font-size: 12pt; color: rgb(54, 101, 238);">reg.yunwei.edu/learn/httpd:latest</a> <span style="font-size: 12pt; color: rgb(54, 101, 238);">--replicas=2</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">在命令行中通过参数指定资源的属性。</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">2. 通过配置文件和 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">kubectl apply</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;"> 创建，要完成前面同样的工作，可执行命令：</span></div><div style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: inherit; overflow-wrap: break-word; overflow: auto; background-color: rgb(255, 255, 255);"><span style="font-size: 12pt; color: rgb(54, 101, 238); line-height: 1.6;">kubectl apply -f httpd.yml</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">httpd.yml 的内容为：</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px;"><img src="K8S创建资源的两种方式_files/Image.png" type="image/png" data-filename="Image.png" style="font-size: 13pt;" width="507"/></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><div><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">资源的属性写在配置文件中，文件格式为 YAML。</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">apiVersion: extensions/v1beta1</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">kind: Deployment</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">metadata:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  name: httpd-deployment</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spec:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  replicas: 2</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  template:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    metadata:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      labels:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        name: httpd</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    spec:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      containers:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      - name: httpd-app</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        image:</span> <a href="http://reg.yunwei.edu/learn/httpd:latest" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">reg.yunwei.edu/learn/httpd:latest</a></div></div></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">下面对这两种方式进行比较。</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; font-weight: bold; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">基于命令的方式：</span></strong></div><ol style="font-size: 17px; margin: 0px 0px 0px 2rem; padding: 0px 0px 0px 2.2em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">简单直观快捷，上手快。</span></div></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">适合临时测试或实验。</span></div></li></ol><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><div><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div><div><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:19.2px;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; font-weight: bold; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">基于配置文件的方式：</span></strong></div></div><ol style="font-size: 17px; margin: 0px 0px 0px 2rem; padding: 0px 0px 0px 2.2em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">配置文件描述了 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">What</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">，即应用最终要达到的状态。</span></div></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">配置文件提供了创建资源的模板，能够重复部署。</span></div></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">可以像管理代码一样管理部署。</span></div></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">适合正式的、跨环境的、规模化部署。</span></div></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">这种方式要求熟悉配置文件的语法，有一定难度。</span></div></li></ol><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">后面我们都将采用配置文件的方式，大家需要尽快熟悉和掌握。</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">kubectl apply</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;"> 不但能够创建 Kubernetes 资源，也能对资源进行更新，非常方便。不过 Kubernets 还提供了几个类似的命令，例如 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">kubectl create</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">、</span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">kubectl replace</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">、</span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">kubectl edit</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;"> 和 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">kubectl patch</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">。</span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><div style="font-size: 19.2px;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">为避免造成不必要的困扰，我们会尽量只使用 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">kubectl apply</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">，</span></div><div style="font-size: 19.2px;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">此命令已经能够应对超过 90% 的场景，事半功倍。</span></div><div style="font-size: 19.2px;"></div><div><br/></div><div><br/></div><div><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 14pt; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 28.8px;">二：</span> <span style="font-size: 14pt; color: rgb(54, 101, 238); font-family: -apple-system-font; font-weight: bold; line-height: 28.8px;">读懂 Deployment YAML</span></span></div><div style="font-size: 19.2px; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243); text-align: left;"><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;">Deployment 的配置格式</span></span></div></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">分析一个 Deployment 的配置文件。 <span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">其他 Controller（比如 DaemonSet）非常类似。</span></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="K8S创建资源的两种方式_files/Image [1].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="498"/></span></span></div></div></div></div></div></div><div><span style="font-size: 16px;">① </span><span style="font-size: 16px;">apiVersion</span><span style="font-size: 16px;"> 是当前配置格式的版本。</span></div><div><span style="font-size: 16px;">② </span><span style="font-size: 16px;">kind</span><span style="font-size: 16px;"> 是要创建的资源类型，这里是 </span><span style="font-size: 16px;">Deployment</span><span style="font-size: 16px;">。</span></div><div><span style="font-size: 16px;">③ </span><span style="font-size: 16px;">metadata</span><span style="font-size: 16px;"> 是该资源的元数据，</span><span style="font-size: 16px;">name</span><span style="font-size: 16px;"> 是必需的元数据项。</span></div><div><span style="font-size: 16px;">④ </span><span style="font-size: 16px;">spec</span><span style="font-size: 16px;"> 部分是该 </span><span style="font-size: 16px;">Deployment</span><span style="font-size: 16px;"> 的规格说明。</span></div><div><span style="font-size: 16px;">⑤ </span><span style="font-size: 16px;">replicas</span><span style="font-size: 16px;"> 指明副本数量，默认为 1。</span></div><div><span style="font-size: 16px;">⑥ </span><span style="font-size: 16px;">template</span><span style="font-size: 16px;"> 定义 Pod 的模板，这是配置文件的重要部分。</span></div><div><span style="font-size: 16px;">⑦ </span><span style="font-size: 16px;">metadata</span><span style="font-size: 16px;"> 定义 Pod 的元数据，至少要定义一个 label。label 的 key 和 value 可以任意指定。</span></div><div><span style="font-size: 16px;-en-paragraph:true;">⑧ </span><span style="font-size: 16px;-en-paragraph:true;">spec</span><span style="font-size: 16px;-en-paragraph:true;"> 描述 Pod 的规格，此部分定义 Pod 中每一个容器的属性，</span><span style="font-size: 16px;-en-paragraph:true;">name</span><span style="font-size: 16px;-en-paragraph:true;"> 和 </span><span style="font-size: 16px;-en-paragraph:true;">image</span><span style="font-size: 16px;-en-paragraph:true;"> 是必需的。</span></div><div><br/></div><div><br/></div><div style="margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243); text-align: left;"><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;">运行yaml配置文件：</span></font></div><div><br/></div><div><span style="font-size: 12pt; font-family: -apple-system-font;">执行如下命令：</span></div><div><span style="font-size: 12pt; font-family: -apple-system-font;"><span style="font-size: 16px; font-family: -apple-system-font; color: rgb(45, 79, 201);"> </span><span style="font-size: 16px; font-family: -apple-system-font; color: rgb(45, 79, 201);">kubectl apply -f </span><span style="font-size: 12pt; font-family: -apple-system-font; color: rgb(45, 79, 201);">httpd.yml </span> <span style="font-size: 12pt; font-family: -apple-system-font; color: rgb(54, 101, 238);">   </span><span style="font-size: 12pt; font-family: -apple-system-font;">运行pod</span></span></div><div><span style="font-size: 16px; color: rgb(45, 79, 201); font-family: -apple-system-font;"> </span><span style="font-size: 16px; color: rgb(45, 79, 201); font-family: -apple-system-font;">kubectl delete -f http.yml</span><span style="font-size: 16px; color: rgb(54, 101, 238); font-family: -apple-system-font;">     </span> <span style="font-size: 16px; font-family: -apple-system-font;">删除pod</span></div><div><br/></div><div><span style="font-size: 16px; font-family: -apple-system-font;"><span style="font-size: 16px; font-family: -apple-system-font; font-weight: bold;">（1）伸缩（Scale Up/Down）:</span> 是指在线增加或减少 Pod 的副本数。直接写改yaml配置文件的<span style="font-size: 12pt; font-family: -apple-system-font;">replicas: 参数即可</span></span></div><div><br/></div><div><span style="font-size: 12pt; font-family: -apple-system-font;">出于安全考虑，默认配置下 Kubernetes 不会将 Pod 调度到 Master 节点。</span></div><div><br/></div><div><br/></div><div><span style="font-size: 12pt; font-family: -apple-system-font;"><span style="font-size: 12pt; font-family: -apple-system-font; font-weight: bold;">（2）节点故障（</span><span style="font-size: 12pt; font-family: -apple-system-font; font-weight: bold;">Failover</span><span style="font-size: 12pt; font-family: -apple-system-font; font-weight: bold;">）:</span> 若其中一个node故障， <span style="font-size: 16px; font-family: -apple-system-font;">Kubernetes 会检查到 k8s-node3 不可用，将 k8s-node1 上的 Pod 标记为 </span><span style="font-size: 16px; font-family: -apple-system-font;">Unknown</span><span style="font-size: 16px; font-family: -apple-system-font;"> 状态，并在 k8s-node2 上新创建两个 Pod，维持总副本数为原指定副本数 3。</span></span></div><div><br/></div><div><span style="font-size: 12pt;"><span style="font-size: 16px;"><span style="font-size: 12pt; font-family: -apple-system-font;">当 k8s-node2 恢复后，Unknown 的 Pod 会被删除，不过已经运行的 Pod 不会重新调度回 k8s-node2。</span></span></span></div><div><br/></div><div><br/></div><div><span style="font-size: 16px; font-family: -apple-system-font;"><span style="font-size: 16px; font-family: -apple-system-font; font-weight: bold;">（3）用 label 控制 Pod 的位置：</span> <span style="font-size: 12pt; font-family: -apple-system-font;">默认配置下，Scheduler 会将 Pod 调度到所有可用的 Node。不过有些情况我们希望将 Pod 部署到指定的 Node，比如将有大量磁盘 I/O 的 Pod 部署到配置了 SSD 的 Node；或者 Pod 需要 GPU，需要运行在配置了 GPU 的节点上。</span></span></div><div><br/></div><div><span style="font-size: 12pt; font-family: -apple-system-font;">Kubernetes 是通过 label 来实现这个功能的。</span><span style="font-size: 12pt; font-family: -apple-system-font;">label 是 key-value 对，各种资源都可以设置 label，灵活添加各种自定义属性。比如执行如下命令标注 k8s-node3 是配置了 SSD 的节点。</span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(45, 79, 201); font-family: -apple-system-font;">kubectl label node 172.16.254.23 disktype=ssd</span></span></div><div><img src="K8S创建资源的两种方式_files/Image [2].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(54, 101, 238);" width="642"/></div><div><br/></div><div><span style="font-size: 12pt;">然后通过：</span><span style="font-size: 12pt; color: rgb(45, 79, 201);">kubectl get node --show-labels </span> <span style="font-size: 16px;">查看节点的 label。</span></div><div><img src="K8S创建资源的两种方式_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">disktype=ssd</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 已经成功添加到 k8s-node3，除了 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">disktype</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">，Node 还有几个 Kubernetes 自己维护的 label。</span></div><div><br/></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">有了 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">disktype</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 这个自定义 label，接下来就可以指定将 Pod 部署到 k8s-node3。编辑 httpd.yml：</span></div><div><img src="K8S创建资源的两种方式_files/Image [4].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font;" width="438"/></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">在 Pod 模板的 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">spec</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> 里通过 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">nodeSelector</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> 指定将此 Pod 部署到具有：</span></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">label </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">disktype=ssd</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> 的 Node 上。</span></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">部署 Deployment 并查看 Pod 的运行节点：</span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(45, 79, 201);">kubectl apply -f .</span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(45, 79, 201);">kubectl get pod -o wide</span></span></div><div><img src="K8S创建资源的两种方式_files/Image [5].png" type="image/png" data-filename="Image.png" style="font-size: 12pt; color: rgb(51, 51, 51);" width="642"/></div><div><span style="font-size: 16px;">全部 2 个副本都运行在 k8s-node1 上，符合我们的预期。</span></div><div><br/></div><div><span style="font-size: 12pt;">要删除 label disktype，执行如下命令：</span><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(45, 79, 201);">kubectl label node k8s-node1 disktype-</span></span><span style="font-size: 12pt;"> 即删除。 <span style="font-size: 16px;">不过此时 Pod 并不会重新部署，依然在 k8s-node1 上运行。</span></span></div><div><img src="K8S创建资源的两种方式_files/Image [6].png" type="image/png" data-filename="Image.png" style="font-size: 12pt;" width="642"/></div><div><span style="font-size: 12pt; color: rgb(45, 79, 201);">kubectl get node --show-labels</span></div><div><img src="K8S创建资源的两种方式_files/Image [7].png" type="image/png" data-filename="Image.png" width="642"/></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">除非在 nginx.yml 中删除 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">nodeSelector</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> 设置，然后通过 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">kubectl apply</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> 重新部署。</span> <span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">Kubernetes 会删除之前的 Pod 并调度和运行新的 Pod。</span></div><div><img src="K8S创建资源的两种方式_files/Image [8].png" type="image/png" data-filename="Image.png" width="642"/></div><div><span style="font-size: 16px;">Kubernetes 会删除之前的 Pod 并调度和运行新的 Pod。</span></div><div><br/></div><div><br/></div><div><span style="font-size: 20px; display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">三、</span><span style="font-size: 15pt; display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">DaemonSet</span><span style="font-size: 20px; display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">：</span></div><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font color="#A8A8A8" style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;">DeamonSet应用</span></font></div><div style="text-align: left;"><span style="font-size: 16px; letter-spacing: 0.034em; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">Deployment 部署的副本 Pod 会分布在各个 Node 上，每个 Node 都可能运行好几个副本。DaemonSet 的不同之处在于：每个 Node 上最多只能运行一个副本。</span></div><div style="overflow-wrap:break-word;hyphens:auto;"><div style="background-color:rgb(255, 255, 255);"><div style="margin: 0px; padding: 0px; overflow: hidden; overflow-wrap: break-word; text-align: justify; position: relative;"><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">DaemonSet 的典型应用场景有：</span></div><ol style="font-size: 17px; margin: 0px 0px 0px 2rem; padding: 0px 0px 0px 2.2em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; font-size: 19.2px; text-rendering: optimizeLegibility;"><span style="max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">在集群的每个节点上运行存储 Daemon，比如 glusterd 或 ceph。</span></div></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; font-size: 19.2px; text-rendering: optimizeLegibility;"><span style="max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">在每个节点上运行日志收集 Daemon，比如 flunentd 或 logstash。</span></div></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; font-size: 19.2px; text-rendering: optimizeLegibility;"><span style="max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">在每个节点上运行监控 Daemon，比如 Prometheus Node Exporter 或 collectd。</span></div></li></ol><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">其实 Kubernetes 自己就在用 DaemonSet 运行系统组件。执行如下命令：</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 12pt; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; letter-spacing: 0.034em; color: rgb(54, 101, 238);">kubectl get daemonset --namespace=kube-system</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 19.2px;"><img src="K8S创建资源的两种方式_files/Image [9].png" type="image/png" data-filename="Image.png" style="font-size: 14pt;" width="642"/></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">DaemonSet </span><span style="font-size: 12pt; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">calico-node</span><span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">分别负责在每个节点上运行 </span><span style="font-size: 12pt; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">calico-node</span> <span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">组件。</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 19.2px;"><img src="K8S创建资源的两种方式_files/Image [10].png" type="image/png" data-filename="Image.png" style="font-size: 14pt;" width="642"/></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">因为 </span><span style="font-size: 12pt; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">calico-node</span> <span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">属于系统组件，需要在命令行中通过 </span><span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; background-color: rgb(216, 216, 216); color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">--namespace=kube-system</span><span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;"> 指定 namespace </span><span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; background-color: rgb(216, 216, 216); color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">kube-system</span><span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">。如果不指定则只返回默认 namespace </span><span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; background-color: rgb(216, 216, 216); color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">default</span><span style="font-size: 16px; max-width: 100%; box-sizing: border-box; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;"> 中的资源。</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><div><span style="font-size: 19.2px;"><img src="K8S创建资源的两种方式_files/Image [11].png" type="image/png" data-filename="Image.png" style="font-size: 14pt;" width="438"/></span></div></div></div></div></div><div><br/></div></span>
</div></body></html> 