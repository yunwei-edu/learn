<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600240 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1051"/>

<div>
<span><div style="-evernote-webclip:true;"><div style="text-align: center;"></div><div style="text-align: center;"><br/></div><div style="text-align: center;"><font style="font-size: 14pt;"><span style="display: inline-block; box-sizing: border-box; letter-spacing: 0.442px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(0, 88, 156); font-size: 14pt; color: rgb(255, 255, 255); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-webclip:true;">第9篇</span><span style="display: inline-block;box-sizing: border-box;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;letter-spacing: 0.034em;-evernote-webclip:true;"><span style="font-size: 14pt; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">k8s 管理机密信息</span></span></font></div><div><br style="font-family: -apple-system-font;"/></div><div><span style="display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; font-size: 14pt; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">一、启动应用安全信息的保护</span><span style="display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; font-size: 14pt; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">：</span></div><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><span style="font-size: 17px;letter-spacing: 0.034em;-evernote-webclip:true;"><span style="font-size: 17px; color: rgb(168, 168, 168); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold;">Secret介绍：</span></span></div><div><span style="font-size: 17px; text-align: justify; letter-spacing: 0.034em; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">应用启动过程中可能需要一些敏感信息，比如访问数据库的用户名密码或者秘钥。将这些信息直接保存在容器镜像中显然不妥，Kubernetes 提供的解决方案是 Secret。</span></div><div style="letter-spacing: 0.034em; background-color: rgb(255, 255, 255);"><div style="overflow-wrap:break-word;hyphens:auto;"><div style="background-color:rgb(255, 255, 255);"><div style="overflow: hidden; overflow-wrap: break-word; text-align: justify;"><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; display: inline-block;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">Secret 会以密文的方式存储数据，避免了直接在配置文件中保存敏感信息。Secret 会以 Volume 的形式被 mount 到 Pod，容器可通过文件的方式使用 Secret 中的敏感数据；此外，容器也可以环境变量的方式使用这些数据。</span></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">Secret 可通过命令行或 YAML 创建。比如希望 Secret 中包含如下信息：</span></div><ol style="font-size: 17px; margin: 0px 0px 0px 2rem; padding: 0px 0px 0px 2.2em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">用户名 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">admin</span></code></div></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">密码 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">123456</span></code></div></li></ol><h2 style="font-size: 16px; margin: 2.5rem 0px 0.3rem; padding: 0px; max-width: 100%; box-sizing: inherit; overflow-wrap: break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:20px;"><span style="font-size: 20px; box-sizing: border-box; margin: 0px; max-width: 100%; overflow-wrap: break-word; padding: 0px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">创建 Secret</span></span></h2><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">有四种方法创建 Secret：</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">1. 通过 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">--from-literal</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">：</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: -apple-system-font; line-height: 1.6;">kubectl create secret generic mysecret --from-literal=username=admin --from-literal=password=123</span></span></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: -apple-system-font; line-height: 1.6;">kubectl get secret</span></span></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;"><span style="font-size: 12pt;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: -apple-system-font; line-height: 1.6;">kubectl get secret mysecret</span></span></span></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">每个 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">--from-literal</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;"> 对应一个信息条目。</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;"><img src="k8s 管理机密信息_files/Image.png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="642"/></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">2. 通过 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">--from-file</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">：</span></div><div style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: inherit; overflow-wrap: break-word; overflow: auto; background-color: rgb(255, 255, 255);"><div><span style="font-size: 12pt; color: rgb(54, 101, 238); line-height: 1.6;">echo -n admin &gt; ./username</span></div><div><span style="font-size: 12pt; color: rgb(54, 101, 238); line-height: 1.6;">echo -n 123456 &gt; ./password</span></div><div><span style="font-size: 12pt; color: rgb(54, 101, 238); line-height: 1.6;">kubectl create secret generic mysecret --from-file=./username --from-file=./password</span></div></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">每个文件内容对应一个信息条目。</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;"><img src="k8s 管理机密信息_files/Image [1].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="642"/></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">3. 通过 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">--from-env-file</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">：</span></div><div style="font-size: 19.2px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: inherit; overflow-wrap: break-word; overflow: auto; background-color: rgb(255, 255, 255);"><div><span style="font-size: 19.2px;"><span style="font-size: 19.2px; color: rgb(54, 101, 238); font-family: monospace, monospace; line-height: 1.6;">cat &lt;&lt; EOF &gt; env.txt</span></span></div><div><span style="font-size: 19.2px;"><span style="font-size: 19.2px; color: rgb(54, 101, 238); font-family: monospace, monospace; line-height: 1.6;">username=admin</span></span></div><div><span style="font-size: 19.2px;"><span style="font-size: 19.2px; color: rgb(54, 101, 238); font-family: monospace, monospace; line-height: 1.6;">password=123456</span></span></div><div><span style="font-size: 19.2px;"><span style="font-size: 19.2px; color: rgb(54, 101, 238); font-family: monospace, monospace; line-height: 1.6;">EOF</span></span></div><div><span style="font-size: 19.2px;"><img src="k8s 管理机密信息_files/Image [2].png" type="image/png" data-filename="Image.png" style="font-family: monospace; font-size: 14pt; color: rgb(51, 51, 51);" width="598"/></span></div><div><span style="font-size: 19.2px;"><span style="font-size: 19.2px; color: rgb(54, 101, 238); font-family: monospace, monospace; line-height: 1.6;">kubectl create secret generic mysecret --from-env-file=env.txt</span></span></div></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">文件 </span><code style="margin:0px;padding:0px;max-width:100%;box-sizing:inherit;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">env.txt</span></code><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;"> 中每行 Key=Value 对应一个信息条目。</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;"><img src="k8s 管理机密信息_files/Image [3].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="642"/></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">4. 通过 YAML 配置文件：</span></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px;"><img src="k8s 管理机密信息_files/Image [4].png" type="image/png" data-filename="Image.png" style="font-size: 13pt;" width="271"/></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">文件中的敏感数据必须是通过 base64 编码后的结果。</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px;"><img src="k8s 管理机密信息_files/Image [5].png" type="image/png" data-filename="Image.png" style="font-size: 13pt;" width="427"/></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="letter-spacing: 0.034em; margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">执行 </span><code style="font-size: 19.2px; letter-spacing: 0.034em; margin: 0px; padding: 0px; max-width: 100%; box-sizing: inherit; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">kubectl apply</span></code><span style="letter-spacing: 0.034em; margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;"> 创建 Secret：</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 19.2px;"><img src="k8s 管理机密信息_files/Image [6].png" type="image/png" data-filename="Image.png" style="letter-spacing: 0.034em; font-size: 13pt;" width="525"/></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px;"><img src="k8s 管理机密信息_files/Image [7].png" type="image/png" data-filename="Image.png" style="font-size: 13pt;" width="527"/></span></div></div></div></div></div></div><div><span style="font-size: 16px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; box-sizing: border-box; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">显示有两个数据条目，</span><span style="font-size: 16px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; box-sizing: border-box; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">kubectl describe secret</span><span style="font-size: 16px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; box-sizing: border-box; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 查看条目的 Key：</span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 19.2px;"><img src="k8s 管理机密信息_files/Image [8].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="446"/></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">如果还想查看 Value，可以用 </span><span style="font-size: 16px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); line-height: 28.8px;">kubectl edit secret mysecret</span></div><div><img src="k8s 管理机密信息_files/Image [9].png" type="image/png" data-filename="Image.png" style="font-size: 12pt; color: rgb(54, 101, 238);" width="642"/></div><div><span style="font-size: 16px;">然后通过 base64 将 Value 反编码：</span></div><div><img src="k8s 管理机密信息_files/Image [10].png" type="image/png" data-filename="Image.png" width="449"/></div><div><br/></div><div><br/></div><div><span style="display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; font-size: 14pt; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">二、secret在pod中的应用</span><span style="display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; font-size: 14pt; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">：</span></div><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(168, 168, 168); font-weight: bold;">volume 方式使用 Secret</span></font></div><div><span style="-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: -apple-system-font;">Pod 可以通过 Volume 或者环境变量的方式使用 Secret，先学习 Volume 方式。</span></span></div><div><span style="text-rendering: optimizeLegibility;"><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">（1）Pod 的配置文件如下所示：</span></span></div><div><img src="k8s 管理机密信息_files/Image [11].png" type="image/png" data-filename="Image.png" width="451"/></div><div><br/></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">① 定义 volume </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">foo</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">，来源为 secret </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">mysecret</span></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">② 将 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">foo</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> mount 到容器路径 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">/etc/foo</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">，可指定读写权限为 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">readOnly</span></div><div><br/></div><div><span style="font-size: 16px; color: rgb(51, 51, 51);">创建 Pod 并在容器中读取 Secret：</span></div><div><img src="k8s 管理机密信息_files/Image [12].png" type="image/png" data-filename="Image.png" style="font-size: 12pt; color: rgb(51, 51, 51);" width="577"/></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">可以看到，Kubernetes 会在指定的路径 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">/etc/foo</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> 下为每条敏感数据创建一个文件，文件名就是数据条目的 Key，这里是 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">/etc/foo/username</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> 和 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">/etc/foo/password</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">，Value 则以明文存放在文件中。</span></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16px; color: rgb(51, 51, 51);">（2）我们也可以自定义存放数据的文件名，比如将配置文件改为：</span></div><div><img src="k8s 管理机密信息_files/Image [13].png" type="image/png" data-filename="Image.png" style="font-size: 12pt; color: rgb(51, 51, 51);" width="508"/></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">这时数据将分别存放在 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">/etc/foo/my-group/my-username</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> 和 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">/etc/foo/my-group/my-password</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> 中。</span></div><div><br/></div><div><span style="font-size: 16px; color: rgb(51, 51, 51);">以 Volume 方式使用的 Secret 支持动态更新：Secret 更新后，容器中的数据也会更新。</span></div><div><br/></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">将 password 更新为 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">abcdef</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">，base64 编码为 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">YWJjZGVm</span></div><div><img src="k8s 管理机密信息_files/Image [14].png" type="image/png" data-filename="Image.png" style="font-size: 12pt; color: rgb(51, 51, 51);" width="495"/></div><div><br/></div><div><span style="font-size: 16px;">更新 Secret。</span></div><div><img src="k8s 管理机密信息_files/Image [15].png" type="image/png" data-filename="Image.png" style="font-size: 12pt; color: rgb(51, 51, 51);" width="299"/></div><div><img src="k8s 管理机密信息_files/Image [16].png" type="image/png" data-filename="Image.png" width="492"/></div><div><br/></div><div><br/></div><div><span style="font-size: 16px;">几秒钟或，新的 password 会同步到容器。</span></div><div><img src="k8s 管理机密信息_files/Image [17].png" type="image/png" data-filename="Image.png" width="494"/></div><div><br/></div><div><br/></div><div><br/></div><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><span style="display: inline-block;box-sizing: border-box;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;letter-spacing: 0.034em;font-size: 14pt;clear: both;max-width: 100%;min-height: 1em;overflow-wrap: break-word;text-rendering: optimizeLegibility;-evernote-webclip:true;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;">环境变量方式使用 Secret</span></span></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: -apple-system-font;">通过 Volume 使用 Secret，容器必须从文件读取数据，会稍显麻烦，Kubernetes 还支持通过环境变量使用 Secret。</span></div><div><br/></div><div><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: -apple-system-font;">Pod 配置文件示例如下：</span></div><div><img src="k8s 管理机密信息_files/Image [18].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="491"/></div><div><br/></div><div><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;">创建 Pod 并读取 Secret。</span></div><div><img src="k8s 管理机密信息_files/Image [19].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="490"/></div><div><br/></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">通过环境变量 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">SECRET_USERNAME</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> 和 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">SECRET_PASSWORD</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"> 成功读取到 Secret 的数据。</span></div><div style="margin-bottom: 1.5rem; font-size: 19.2px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">需要注意的是，环境变量读取 Secret 很方便，但无法支撑 Secret 动态更新。</span></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">Secret 可以为 Pod 提供密码、Token、私钥等敏感数据；</span></div></span>
</div></body></html> 