<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600240 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1143"/>

<div>
<span><div style="-evernote-webclip:true;"><div style="background-color: rgb(255, 255, 255);"><div style="overflow-wrap: break-word;"><div style="background-color: rgb(255, 255, 255);"><div style="overflow: hidden; overflow-wrap: break-word; text-align: justify;"><div style="letter-spacing: 0.034em; margin: 1em auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-width: initial; border-color: initial; border-style: none; text-align: center; width: 18em;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><font style="font-size: 14pt;"><span style="display: inline-block; box-sizing: border-box; letter-spacing: 0.442px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(0, 88, 156); font-size: 14pt; color: rgb(255, 255, 255); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-webclip:true;">第3篇</span><span style="display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; font-size: 14pt; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-webclip:true;">K8S集群部署</span></font></div></div><div style="letter-spacing: 0.034em; font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 20px;"><span style="font-size: 20px; font-weight: bold; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">一、利用ansible部署kubernetes准备：</span></span></strong></div><div style="letter-spacing: 0.034em; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243); text-align: left;"><span style="max-width: 100%;box-sizing: border-box;overflow-wrap: break-word;-evernote-webclip:true;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 28.8px;">集群介绍</span></span></div><div style="letter-spacing: 0.034em; font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;"><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">本系列文档致力于提供快速部署高可用k8s集群的工具，并且也努力成为k8s实践、使用的参考书；基于二进制方式部署和利用ansible-playbook实现自动化：既提供一键安装脚本，也可以分步执行安装各个组件，同时讲解每一步主要参数配置和注意事项；二进制方式部署有助于理解系统各组件的交互原理和熟悉组件启动参数，有助于快速排查解决实际问题。</span></span></div><div style="letter-spacing: 0.034em; font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><div style="font-size: 19.2px; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243); text-align: left;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;"><span style="font-size: 16px; color: rgb(168, 168, 168); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 28.8px;">版本组件</span></span></div></div><div style="letter-spacing: 0.034em; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 11pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;; line-height: 1.6;-en-paragraph:true;">kubernetes</span> <span style="font-size: 11pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;; line-height: 1.6;-en-paragraph:true;">v1.9.7</span></span></div><div style="letter-spacing: 0.034em; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 11pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">etcd</span> <span style="font-size: 11pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">v3.3.4</span></div><div style="letter-spacing: 0.034em; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"><span style="font-size: 11pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;">docker </span><span style="font-size: 11pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;">18.03.0-ce</span></span></div><div style="letter-spacing: 0.034em; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 11pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;">calico/node:v3.0.6</span></div><div style="letter-spacing: 0.034em;"><span style="font-size: 11pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;">calico/cni:v2.0.5</span></div><div style="letter-spacing: 0.034em; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 11pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;">calico/kube-controllers:v2.0.4</span></div><div style="letter-spacing: 0.034em; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 11pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">centos</span> <span style="font-size: 11pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">7.3+</span></div><div style="letter-spacing: 0.034em; font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"></div><div style="letter-spacing: 0.034em; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243); text-align: left;"><span style="-en-paragraph:true;"><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-family: Verdana; font-weight: bold;">集群规划和基础参数设定</span></font></span></div><ol style="letter-spacing: 0.034em; margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-right: 0pt; padding-left: 11pt; text-indent: 0pt;"><div style="margin-top: 10pt; margin-bottom: 6pt;"><h2><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana; font-weight: bold;">1、高可用集群所需节点配置如下：</span></span></h2></div></li></ol><ul style="letter-spacing: 0.034em; margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt; list-style-type: disc;"><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">部署节点 x1 : 运行这份 ansible 脚本的节点</span></span></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">etcd</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">节点 x3 : 注意etcd集群必须是1,3,5,7...奇数个节点</span></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">master</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">节点 x1 : 运行集群主要组件</span></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt; text-indent: 0pt; letter-spacing: 0.034em; color: rgb(0, 0, 10); font-family: Verdana;">node</span><span style="font-size: 12pt; text-indent: 0pt; letter-spacing: 0.034em; color: rgb(0, 0, 10); font-family: Verdana;">节点 x3 : 真正应用部署的节点，根据需要增加机器配置和节点数</span></div></li></ul><ol style="letter-spacing: 0.034em; margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-right: 0pt; padding-left: 11pt; text-indent: 0pt;"><div style="margin-top: 10pt; margin-bottom: 6pt;"><h2><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;; font-weight: bold;">2、在部署节点准备ansible：</span><span style="font-size: 12pt; font-weight: normal;">使用ansible的doker环境启动</span></h2></div></li></ol><div style="letter-spacing: 0.034em; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 12pt;">（1）下载内部源配置脚本</span></div><div style="letter-spacing: 0.034em; font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px;"><img src="K8S集群部署_files/Image.png" type="image/png" data-filename="Image.png" style="font-size: 13pt;" width="361"/></span></div><div style="letter-spacing: 0.034em; font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">wget</span> <a href="http://download.yunwei.edu/shell/yum-repo.sh" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">download.yunwei.edu/shell/yum-repo.sh</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">sh yum-repo.sh</span></div></div><div><br/></div></div><div style="letter-spacing: 0.034em; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">（2）下载并安装docker</span></span></div><div style="letter-spacing: 0.034em; font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">wget</span> <a href="http://download.yunwei.edu/shell/docker.tar.gz" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">download.yunwei.edu/shell/docker.tar.gz</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ls</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">tar zxvf docker.tar.gz</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ls</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">cd docker/</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ls</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">sh docker.sh</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">systemctl status docker</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">docker images</span></div></div></div><div style="letter-spacing: 0.034em; font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;"><img src="K8S集群部署_files/Image [1].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="362"/></span></div><div><br/></div></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><div style="letter-spacing: 0.034em;"><span style="font-size: 12pt;">（3）下载并运行docker版ansible</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">docker pull</span> <a href="http://reg.yunwei.edu/learn/ansible:alpine3" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">reg.yunwei.edu/learn/ansible:alpine3</a></div><div><font style="font-size: 9pt;"><span style="font-family: Monaco; color: rgb(51, 51, 51);">docker run -itd -v /etc/ansible:/etc/ansible -v </span><span style="line-height: 1.45; font-family: Monaco; color: rgb(51, 51, 51);">/etc/kubernetes/:/etc/kubernetes/ -v /root/.kube:/root/.kube -v </span><span style="line-height: 1.45; font-family: Monaco; color: rgb(51, 51, 51);">/usr/local/bin/:/usr/local/bin/ 1acb4fd5df5b  /bin/sh</span></font></div></div><div style="letter-spacing: 0.034em;"><br/></div><div style="letter-spacing: 0.034em;"><span style="font-size: 12pt;">（4）配置每台机器之间主机名以及解析</span></div><div style="letter-spacing: 0.034em;"><img src="K8S集群部署_files/Image [2].png" type="image/png" data-filename="Image.png" style="font-size: 12pt;"/></div><div style="letter-spacing: 0.034em;"><br/></div><div style="letter-spacing: 0.034em;"><span style="letter-spacing: 0.034em;"><span style="font-size: 12pt; font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;">（5）进入ansible容器，</span><span style="font-size: 12pt; font-family: -apple-system-font; line-height: 28.8px;">配置免密登录</span></span></div><div style="letter-spacing: 0.034em;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">#</span><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: &quot;Liberation Serif&quot;;">ssh-keygen</span></span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">  </span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">回车 回车 回车</span></div><div style="letter-spacing: 0.034em;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">#</span><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: &quot;Liberation Serif&quot;;">ssh-copy-id $Ips   </span><span style="font-size: 12pt; font-family: &quot;Liberation Serif&quot;;">#$IPs</span></span><span style="font-size: 12pt; font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">为</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">所有节点地址包括自身，按照提示输入</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">yes</span> <span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">和</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">root</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">密码</span></div><div style="letter-spacing: 0.034em;"><span style="letter-spacing: 0.034em; font-size: 12pt; color: rgb(0, 0, 10); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 28.8px;-evernote-webclip:true;">测试各节点是否正常</span></div><div style="letter-spacing: 0.034em;"><img src="K8S集群部署_files/Image [3].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt;" width="318"/></div><div style="letter-spacing: 0.034em;"></div><div style="letter-spacing: 0.034em;"></div><div style="letter-spacing: 0.034em;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-evernote-webclip:true;">（6）</span></div><div style="letter-spacing: 0.034em;"></div><div style="letter-spacing: 0.034em;"></div><div style="letter-spacing: 0.034em;"></div><div style="letter-spacing: 0.034em;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;; font-weight: bold;-evernote-webclip:true;">3、在部署节点<span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;; font-weight: bold;">上传ansible工作文件如下：</span></span></div><div style="letter-spacing: 0.034em;"><img src="K8S集群部署_files/Image [4].png" type="image/png" data-filename="Image.png" style="font-weight: bold; font-family: Noto Sans CJK SC Regular; font-size: 12pt; color: rgb(0, 0, 10);" width="467"/></div><div style="letter-spacing: 0.034em;"><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: &quot;Liberation Serif&quot;;">#cp /etc/ansible/example/hosts.s-masters.example /etc/ansible/hosts</span></span></div><div style="letter-spacing: 0.034em;"><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: &quot;Liberation Serif&quot;;">#vi /etc/ansible/hosts</span></span></div><div style="letter-spacing: 0.034em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;Liberation Serif&quot;;font-size: 12pt;-en-paragraph:true;"><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 部署节点：运行ansible 脚本的节点</span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[deploy]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">192.168.254.20</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># etcd集群请提供如下NODE_NAME、NODE_IP变量,请注意etcd集群必须是1,3,5,7...奇数个节点</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[etcd]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">192.168.254.21 NODE_NAME=etcd1 NODE_IP=&quot;<span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>254.21&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">192.168.254.22 NODE_NAME=etcd2 NODE_IP=&quot;<span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>254.22&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">192.168.254.23 NODE_NAME=etcd3 NODE_IP=&quot;<span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>254.23&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[kube-master]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>.254.21 NODE_IP=&quot;<span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>.254.21&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[kube-node]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>254.21 NODE_IP=&quot;<span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>254.21&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>254.22 NODE_IP=&quot;<span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>254.22&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>254.23 NODE_IP=&quot;<span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>254.23&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[all:vars]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># ---------集群主要参数---------------</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">#集群部署模式：allinone, single-master, multi-master</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">DEPLOY_MODE=single-master</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">#集群 MASTER IP</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">MASTER_IP=&quot;<span style="font-family: Monaco;font-size: 9pt;color: rgb(51, 51, 51);-evernote-webclip:true;-en-paragraph:true;">192.168.</span>254.21&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">#集群 APISERVER</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">KUBE_APISERVER=&quot;</span><a href="https://172.16.254.21:6443/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">https://192.168.254.21:6443</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">#TLS Bootstrapping 使用的 Token，使用 head -c 16 /dev/urandom | od -An -t x | tr -d ' ' 生成</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">BOOTSTRAP_TOKEN=&quot;d18f94b5fa585c7123f56803d925d2e7&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 集群网络插件，目前支持calico和flannel</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">CLUSTER_NETWORK=&quot;calico&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 部分calico相关配置，更全配置可以去roles/calico/templates/calico.yaml.j2自定义</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 设置 CALICO_IPV4POOL_IPIP=“off”,可以提高网络性能，条件限制详见 05.安装calico网络组件.md</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">CALICO_IPV4POOL_IPIP=&quot;always&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 设置 calico-node使用的host IP，bgp邻居通过该地址建立，可手动指定端口&quot;interface=eth0&quot;或使用如下自动发现</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">IP_AUTODETECTION_METHOD=&quot;can-reach=223.5.5.5&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 部分flannel配置，详见roles/flannel/templates/kube-flannel.yaml.j2</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">FLANNEL_BACKEND=&quot;vxlan&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 服务网段 (Service CIDR），部署前路由不可达，部署后集群内使用 IP:Port 可达</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">SERVICE_CIDR=&quot;10.68.0.0/16&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># POD 网段 (Cluster CIDR），部署前路由不可达，**部署后**路由可达</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">CLUSTER_CIDR=&quot;172.20.0.0/16&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 服务端口范围 (NodePort Range)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">NODE_PORT_RANGE=&quot;20000-40000&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># kubernetes 服务 IP (预分配，一般是 SERVICE_CIDR 中第一个IP)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">CLUSTER_KUBERNETES_SVC_IP=&quot;10.68.0.1&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 集群 DNS 服务 IP (从 SERVICE_CIDR 中预分配)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">CLUSTER_DNS_SVC_IP=&quot;10.68.0.2&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 集群 DNS 域名</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">CLUSTER_DNS_DOMAIN=&quot;cluster.local.&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># etcd 集群间通信的IP和端口, **根据实际 etcd 集群成员设置**</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ETCD_NODES=&quot;etcd1=</span><a href="https://172.16.254.21:2380,etcd2=https://172.16.254.22:2380,etcd3=https://172.16.254.23:2380" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">https://192.168.254.21:2380,etcd2=https://192.168.254.22:2380,etcd3=https://192.168.254.23:2380</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># etcd 集群服务地址列表, **根据实际 etcd 集群成员设置**</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ETCD_ENDPOINTS=&quot;</span><a href="https://172.16.254.21:2379,https://172.16.254.22:2379,https://172.16.254.23:2379" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">https://192.168.254.21:2379,https://192.168.254.22:2379,https://192.168.254.23:2379</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 集群basic auth 使用的用户名和密码</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">BASIC_AUTH_USER=&quot;admin&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">BASIC_AUTH_PASS=&quot;admin&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># ---------附加参数--------------------</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">#默认二进制文件目录</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">bin_dir=&quot;/usr/local/bin&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">#证书目录</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ca_dir=&quot;/etc/kubernetes/ssl&quot;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">#部署目录，即 ansible 工作目录</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">base_dir=&quot;/etc/ansible&quot;</span></div></div></div><div style="letter-spacing: 0.034em;"></div><div style="letter-spacing: 0.034em;"></div><div style="letter-spacing: 0.034em;"></div><div style="letter-spacing: 0.034em;"></div><div style="letter-spacing: 0.034em;"><span style="letter-spacing: 0.034em; font-size: 14pt; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 28.8px;">二：</span> <span style="letter-spacing: 0.034em; font-size: 14pt;"><span style="max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 20px; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">部署kubernetes过程</span></span></div><div><br/></div><div><span style="font-size: 12pt;">（1）解压 二进制文件包：k8s197.tar.gz，之后将解压后的 bin 目录下的所有二进制文件 mv 到 /etc/ansible/bin/下</span></div><div><img src="K8S集群部署_files/Image [5].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt;" width="642"/></div><div><span style="font-size: 12pt; font-family: -apple-system-font;">（2）进入ansible-docker容器，进入/etc/ansible目录：</span></div><div><img src="K8S集群部署_files/Image [6].png" type="image/png" data-filename="Image.png" style="font-weight: bold; font-family: -apple-system-font;" width="642"/></div><div><br/></div><div><br/></div><div style="letter-spacing: 0.034em; font-size: 19.2px; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243); text-align: left;"><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;">创建CA证书和环境配置</span></span></div></div><div style="letter-spacing: 0.034em; font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">主要完成</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">CA</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">证书创建、分发、环境变量。</span></div><div style="letter-spacing: 0.034em; font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;">kubernetes 系统各组件需要使用 TLS 证书对通信进行加密，使用 CloudFlare 的  PKI 工具集生成自签名的CA证书，用来签名后续创建的其它 TLS 证书。</span></span></div><div style="letter-spacing: 0.034em; font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 12pt; letter-spacing: 0.034em; color: rgb(54, 101, 238); font-family: &quot;Liberation Serif&quot;;">#ansible-playbook 01.prepare.yml</span></div></div></div></div></div></div><div><br/></div><div><br/></div><div style="margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243); text-align: left;"><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;">安装etcd集群</span></font></div><div><br/></div><div><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">kuberntes</span> <span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">系统使用</span> <span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">etcd</span> <span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">存储所有数据，是最重要的组件之一，注意</span> <span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">etcd</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">集群只能有奇数个节点</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">(1,3,5...)</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">，本文档使用</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">3</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">个节点做集群。</span></div><div><br/></div><div><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: &quot;Liberation Serif&quot;;">#ansible-playbook 02.etcd.yml</span></span></div><div><br/></div><div><br/></div><div><br/></div><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">kubectl</span><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">命令行工具</span></font></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">kubectl</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">使用</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">~/.kube/config</span> <span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">配置文件与</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">kube-apiserver</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">进行交互，且拥有完全权限，因此尽量避免安装在不必要的节点上。</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">cat ~/.kube/config</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">可以看到配置文件包含</span> <span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Liberation Serif&quot;;-en-paragraph:true;">kube-apiserver</span> <span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: &quot;Noto Sans CJK SC Regular&quot;;-en-paragraph:true;">地址、证书、用户名等信息。</span></div><div style="text-align: left;"><img src="K8S集群部署_files/Image [7].png" type="image/png" data-filename="Image.png" width="258"/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="overflow-wrap:break-word;hyphens:auto;"><div style="background-color:rgb(255, 255, 255);"><div style="margin: 0px; padding: 0px; overflow: hidden; overflow-wrap: break-word; text-align: justify; position: relative;"><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">安装</span><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">docker</span><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">服务</span></font></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: Verdana;">#ansible-playbook 03.docker.yml</span></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"></div><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">安装</span><span style="font-size: 12pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">kube-master</span><span style="font-size: 12pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">节点</span></font></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">部署master节点包含三个组件`apiserver` `scheduler` `controller-manager`，其中：</span></span></div><div style="min-height: 15pt;"><span style="min-height: 15pt; font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana; font-weight: bold;">apiserver：</span></span><span style="min-height: 15pt; font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">提供集群管理的REST API接口，包括认证授权、数据校验以及集群状态变更等</span></div><ul style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt; list-style-type: disc;"><li style="margin-left: 38pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">只有API Server才直接操作etcd</span></span></div></li><li style="margin-left: 38pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">其他模块通过API Server查询或修改数据</span></span></div></li><li style="margin-left: 38pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">提供其他模块之间的数据交互和通信的枢纽</span></span></div></li></ul><div style="min-height: 15pt;"><span style="min-height: 15pt; font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana; font-weight: bold;">scheduler：</span></span><span style="min-height: 15pt; font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">负责分配调度Pod到集群内的node节点</span></div><ul style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt; list-style-type: disc;"><li style="margin-left: 35pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">监听kube-apiserver，查询还未分配Node的Pod</span></span></div></li><li style="margin-left: 35pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">根据调度策略为这些Pod分配节点</span></span></div></li></ul><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="min-height: 15pt; font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana; font-weight: bold;">controller-manager：</span></span><span style="min-height: 15pt; font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">由一系列的控制器组成，它通过apiserver监控整个集群的状态，并确保集群处于预期的工<span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;-en-paragraph:true;">状态</span></span></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="min-height: 15pt; font-size: 12pt;"><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: Verdana;">#ansible-playbook <span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: Verdana;">04.kube-master.yml</span></span></span></span></div><div style="text-align: left;"><br style="font-family: Verdana; font-size: 12pt; color: rgb(54, 101, 238);"/></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; box-sizing: inherit; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><div style="background-color: rgb(255, 255, 255);"><div style="margin: 0px; padding: 0px; overflow: hidden; overflow-wrap: break-word; text-align: justify; position: relative;"><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">安装</span><span style="font-size: 12pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">kube-node</span><span style="font-size: 12pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">节点</span></font></div><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;-en-paragraph:true;">node</span> <span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;-en-paragraph:true;">是集群中承载应用的节点，前置条件需要先部署好</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;-en-paragraph:true;">master</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;-en-paragraph:true;">节点</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;-en-paragraph:true;">(</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;-en-paragraph:true;">因为需要操作用户角色绑定、批准</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;-en-paragraph:true;">kubelet TLS</span> <span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;-en-paragraph:true;">证书请求等</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;-en-paragraph:true;">)</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;-en-paragraph:true;">，它需要部署如下组件：</span></div><ul style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt; list-style-type: disc;"><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">docker</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">：运行容器</span></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">calico</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">： 配置容器网络</span></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">kubelet</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">： node上最主要的组件</span></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">kube-proxy</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">： 发布应用服务与负载均衡</span></div></li><li><div><br/></div></li></ul><div style="font-size: 19.2px; margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: Verdana;">#ansible-playbook <span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: Verdana;">05.kube-node.yml</span></span></div><div style="text-align: left;"><br style="font-family: Verdana; font-size: 12pt; color: rgb(54, 101, 238);"/></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><div style="background-color: rgb(255, 255, 255);"><div style="margin: 0px; padding: 0px; overflow: hidden; overflow-wrap: break-word; text-align: justify; position: relative;"><div style="font-size: 19.2px; text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><span style="font-size: 12pt; color: rgb(168, 168, 168); font-weight: bold;-en-paragraph:true;">安装网络</span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">（1）每个节点准备如下镜像tar包：</span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [8].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">（2）解压image.tar.gz得出如下镜像，</span><span style="font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">各节点导入解压得到的镜像</span><span style="font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">：</span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [9].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">（3）ansible容器中执行：</span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: Verdana;">#ansible-playbook 06.network.yml</span></div></div></div><div style="font-size: 19.2px;"></div><div><span style="font-size: 12pt;">（4）验证calico网络：</span></div><div><br/></div><div><img src="K8S集群部署_files/Image [10].png" type="image/png" data-filename="Image.png" style="background-color: transparent;" width="642"/></div><div><br/></div><div><br/></div><div style="background-color: rgb(255, 255, 255);"><div style="margin: 0px; padding: 0px; overflow: hidden; overflow-wrap: break-word; text-align: justify; position: relative;"><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(168, 168, 168); font-weight: bold;">部署coredns服务</span></font></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 16px; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(0, 0, 10); font-family: Verdana;">（1）进入</span><span style="font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">/etc/ansible/manifests 目录</span><span style="font-size: 16px; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(0, 0, 10); font-family: Verdana;">：</span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [11].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">（2）进入coredns工作</span><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">目录，并创建pod</span><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">：</span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: Verdana;">#kubectl create -f coredns.yaml</span></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [12].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">（3）验证coredns：</span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [13].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></div><div><span style="font-size: 12pt; font-family: Verdana;">在集群中任意节点都能ping通pod服务IP</span></div><div><img src="K8S集群部署_files/Image [14].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt;" width="465"/></div><div><br/></div><div><br/></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><div style="margin: 0px; padding: 0px; overflow: hidden; overflow-wrap: break-word; text-align: justify; position: relative;"><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(168, 168, 168); font-weight: bold;">部署dashboard</span></font></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">（1）进入</span><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">dashboard工作目录，并创建pod</span><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">：</span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: Verdana;">#kubectl create -f .</span></span></span></div></div><div><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [15].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></div></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="font-size: 16px; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(0, 0, 10); font-family: Verdana;">（2）验证</span><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">dashboard</span><span style="font-size: 16px; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(0, 0, 10); font-family: Verdana;">：</span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [16].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">（3）查看 dashboard 服务端点，并登陆：</span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="font-size: 16px; color: rgb(54, 101, 238); font-family: Verdana;">#</span><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: Verdana;">kubectl cluster-info</span></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [17].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">将dashboard 服务端点复制到浏览器并打开（用户名/密码：admin/admin）</span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [18].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [19].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">需要输入 Token 方可登陆，获取 Token：</span></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: Verdana;">#kubectl -n kube-system describe secret $(kubectl -n kube-system get secret|grep admin-user|awk '{print $1}')</span></span></span></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [20].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">登陆成功：</span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [21].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><div style="margin: 0px; padding: 0px; overflow: hidden; overflow-wrap: break-word; text-align: justify; position: relative;"><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(168, 168, 168); font-weight: bold;">部署heapster监控</span></font></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">（1）进入</span><span style="font-size: 12pt; font-family: Verdana;">heapster工作</span></span><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">目录，并创建pod</span><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">：</span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><img src="K8S集群部署_files/Image [22].png" type="image/png" data-filename="Image.png" style="color: rgb(0, 0, 10); font-family: Verdana; font-size: 12pt;"/></div></div><div><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">（2）<span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">验证</span><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 12pt; color: rgb(0, 0, 10); font-family: Verdana;">监控</span><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;">：</span></span></span></span></span></div></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [23].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [24].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></span></div><div style="margin: 0px 0px 1.5rem; padding: 0px; max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px;"><span style="max-width: 100%; clear: both; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 16px; color: rgb(0, 0, 10); font-family: Verdana;"><img src="K8S集群部署_files/Image [25].png" type="image/png" data-filename="Image.png" style="font-family: Verdana; font-size: 12pt; color: rgb(0, 0, 10);" width="642"/></span></span></span></div></div></div></div></div></div></div></div></div></div><div><br/></div></span>
</div></body></html> 