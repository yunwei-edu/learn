<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600240 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="914"/>

<div>
<span><div><div><div style="-evernote-webclip:true;"><div style="text-align: center;"></div><div style="text-align: center;"></div><div style="text-align: center;"><br/></div><div style="text-align: center;"><font style="font-size: 14pt;"><span style="display: inline-block; box-sizing: border-box; letter-spacing: 0.442px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(0, 88, 156); font-size: 14pt; color: rgb(255, 255, 255); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-webclip:true;">第6篇</span><span style="display: inline-block;box-sizing: border-box;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;letter-spacing: 0.034em;-evernote-webclip:true;"><span style="font-size: 14pt; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">如何访问pod</span></span></font></div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="display: inline-block;box-sizing: border-box;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;letter-spacing: 0.034em;-evernote-webclip:true;"><font style="font-size: 14pt;"><span style="box-sizing: border-box; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 14pt; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;">一、</span><span style="font-size: 14pt; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;">通过 Service 访问 Pod</span><span style="box-sizing: border-box; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; font-size: 14pt; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;">：</span></font></span></div><div style="text-align: left;"><span style="display: inline-block;box-sizing: border-box;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;letter-spacing: 0.034em;-evernote-webclip:true;"><span style="box-sizing: border-box; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility;"><span style="font-size: 12pt; font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 28.8px;">我们不应该期望 Kubernetes Pod 是健壮的，而是要假设 Pod 中的容器很可能因为各种原因发生故障而死掉。Deployment 等 controller 会通过动态创建和销毁 Pod 来保证应用整体的健壮性。换句话说，Pod 是脆弱的，但应用是健壮的。</span></span></span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: -apple-system-font;">每个 Pod 都有自己的 IP 地址。当 controller 用新 Pod 替代发生故障的 Pod 时，新 Pod 会分配到新的 IP 地址。这样就产生了一个问题：</span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: -apple-system-font;">如果一组 Pod 对外提供服务（比如 HTTP），它们的 IP 很有可能发生变化，那么客户端如何找到并访问这个服务呢？</span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: -apple-system-font;">Kubernetes 给出的解决方案是 Servi</span><span style="font-size: 12pt; font-family: -apple-system-font;">ce</span><span style="font-size: 15pt; font-family: -apple-system-font;">。</span></div><div style="text-align: left;"></div><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;">创建 Service</span></span></div><div style="text-align: center;"></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">Kubernetes Service 从逻辑上代表了一组 Pod，</span><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; color: rgb(255, 0, 0); font-family: -apple-system-font; line-height: 28.8px;">具体是哪些 Pod 则是由 label 来挑选。</span></span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">Service 有自己 IP，而且这个 IP 是不变的。客户端只需要访问 Service 的 IP，Kubernetes 则负责建立和维护 Service 与 Pod 的映射关系。无论后端 Pod 如何变化，对客户端不会有任何影响，因为 Service 没有变。</span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">来看个例子，创建下面的这个 Deployment：</span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image.png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="437"/></span></div><div style="text-align: left;"><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: -apple-system-font;">我们启动了两个 Pod，运行 httpd 镜像，label 是 run: httpd，Service 将会用这个 label 来挑选 Pod。</span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image [1].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="642"/></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">Pod 分配了各自的 IP，这些 IP 只能被 Kubernetes Cluster 中的容器和节点访问。</span></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image [2].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="446"/></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">接下来创建 Service，其配置文件如下：</span></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image [3].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="267"/></span></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">① </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">v1</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 是 Service 的 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">apiVersion</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">。</span></span></span></div><div style="margin-bottom: 1.5rem; font-size: 19.2px; text-rendering: optimizeLegibility; text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">② 指明当前资源的类型为 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">Service</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">。</span></div><div style="margin-bottom: 1.5rem; font-size: 19.2px; text-rendering: optimizeLegibility; text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">③ Service 的名字为 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">。</span></div><div style="margin-bottom: 1.5rem; font-size: 19.2px; text-rendering: optimizeLegibility; text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">④ </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">selector</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 指明挑选那些 label 为 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">run: httpd</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 的 Pod 作为 Service 的后端。</span></div><div style="margin-bottom: 1.5rem; font-size: 19.2px; text-rendering: optimizeLegibility; text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">⑤ 将 Service 的 8080 端口映射到 Pod 的 80 端口，使用 TCP 协议。</span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">执行 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">kubectl apply</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 创建 Service </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">。</span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image [4].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="642"/></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 分配到一个 CLUSTER-IP </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">10.68.132.230</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">。可以通过该 IP 访问后端的 httpd Pod。</span></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image [5].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="540"/></span></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">根据前面的端口映射，这里要使用 8080 端口。另外，除了我们创建的 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">，还有一个 Service </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">kubernetes</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">，Cluster 内部通过这个 Service 访问 kubernetes API Server。</span></span></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">通过 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">kubectl describe</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 可以查看 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 与 Pod 的对应关系。</span></span></span></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: -apple-system-font; line-height: 28.8px;">kubectl describe service httpd-svc</span></span></span></span></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: -apple-system-font; line-height: 28.8px;">kubectl get pod -o wide</span></span></span></span></span></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image [6].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="642"/></span></span></span></span></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">Endpoints</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 罗列了两个 Pod 的 IP 和端口。我们知道 Pod 的 IP 是在容器中配置的，那么 Service 的 Cluster IP 又是配置在哪里的呢？CLUSTER-IP 又是如何映射到 Pod IP 的呢？</span></span></span></span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 12pt; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">答案是 iptables</span></span></span></span></div><div style="text-align: left;"><br/></div></div><div><br/></div><div><span style="font-size: 20px; display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">二、</span><span style="font-size: 15pt;display: inline-block;box-sizing: border-box;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;letter-spacing: 0.034em;-evernote-webclip:true;"><span style="font-size: 15pt;"><span style="font-size: 15pt; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;">Service IP 原理</span></span></span><span style="font-size: 20px; display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">：</span></div><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 14pt;"><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;">Service IP 原理</span></span></font></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">Service Cluster IP 是一个虚拟 IP，是由 Kubernetes 节点上的 iptables 规则管理的。</span></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">可以通过 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">iptables-save</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 命令打印出当前节点的 iptables 规则，因为输出较多，这里只截取与 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> Cluster IP </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">10.68.132.230</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 相关的信息：</span></div><div><img src="如何访问pod_files/Image [7].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font;"/></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">这条规则的含义是：</span></div><div><span style="font-size: 16px;-en-paragraph:true;">如果 Cluster 内的 Pod要访问 </span><span style="font-size: 16px;-en-paragraph:true;">httpd-svc</span><span style="font-size: 16px;-en-paragraph:true;">，</span><span style="font-size: 16px;-en-paragraph:true;">跳转到规则 <span style="font-size: 12pt;">KUBE-SVC-RL3JAE4GN7VOGDGP</span></span></div><div><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;"><span style="font-size: 12pt; color: rgb(51, 51, 51); line-height: 28.8px;-en-paragraph:true;">KUBE-SVC-RL3JAE4GN7VOGDGP</span> 规则如下：</span></div><div><img src="如何访问pod_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><ol style="margin-left: 2rem;"><li><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px;-en-paragraph:true;">1/2的概率跳转到规则 <span style="font-size: 12pt;">KUBE-SEP-GSULT7CRYYSEJLVK</span></span><span style="font-size: 16px;-en-paragraph:true;">。</span></div></li><li><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px;-en-paragraph:true;">1/2 的概率（剩下 2/3 的一半）跳转到规则 <span style="font-size: 12pt;">KUBE-SEP-VYMFHNMHVUQT37BD</span></span><span style="font-size: 16px;-en-paragraph:true;">。</span></div></li></ol><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px;">上面两个跳转的规则如下：</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><img src="如何访问pod_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">即将请求分别转发到后端的两个 Pod。通过上面的分析，我们得到如下结论：</span></div><div style="margin-bottom: 1.5rem; font-size: 19.2px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-weight: bold; line-height: 28.8px;">iptables 将访问 Service 的流量转发到后端 Pod，而且使用类似轮询的负载均衡策略</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); line-height: 28.8px;">另外需要补充一点：Cluster 的每一个节点都配置了相同的 iptables 规则，这样就确保了整个 Cluster 都能够通过 Service 的 Cluster IP 访问 Service。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 20px; display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">二、</span><span style="font-size: 15pt;display: inline-block;box-sizing: border-box;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;letter-spacing: 0.034em;-evernote-webclip:true;"><span style="font-size: 15pt; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;">DNS 访问 Service</span></span><span style="font-size: 20px; display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">：</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 20px;display: inline-block;box-sizing: border-box;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;letter-spacing: 0.034em;clear: both;max-width: 100%;min-height: 1em;overflow-wrap: break-word;text-rendering: optimizeLegibility;-evernote-webclip:true;"><span style="font-size: 16px; font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 28.8px;">在 Cluster 中，除了可以通过 Cluster IP 访问 Service，Kubernetes 还提供了更为方便的 DNS 访问。</span></span></div><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;">DNS组件</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;">kubeadm 部署时会默认安装 kube-dns 组件。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;"><img src="如何访问pod_files/Image [10].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="587"/></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">coredns 是一个 DNS 服务器。每当有新的 Service 被创建，coredns 会添加该 Service 的 DNS 记录。Cluster 中的 Pod 可以通过 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">&lt;SERVICE_NAME&gt;.&lt;NAMESPACE_NAME&gt;</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 访问 Service。</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">比如可以用 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc.default</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 访问 Service </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: -apple-system-font; line-height: 28.8px;">kubectl run busybox --rm -ti --image=</span><a href="http://reg.yunwei.edu/learn/busybox:latest" style="font-size: 12pt; color: rgb(54, 101, 238); font-family: -apple-system-font; line-height: 28.8px;">reg.yunwei.edu/learn/busybox:latest</a> <span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: -apple-system-font; line-height: 28.8px;">/bin/sh</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 12pt;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238); font-family: -apple-system-font; line-height: 28.8px;">wget httpd-svc:8080</span></span></span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image [11].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="642"/></span></div></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 20px; display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">三、</span><span style="font-size: 15pt; display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">外网访问 Service</span><span style="font-size: 20px; display: inline-block; box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; clear: both; max-width: 100%; min-height: 1em; overflow-wrap: break-word; text-rendering: optimizeLegibility; color: rgb(54, 101, 238); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28.8px;-evernote-webclip:true;">：</span></div><div style="text-align: left; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(168, 168, 168); font-weight: bold;">外网如何访问 Service？</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">除了 Cluster 内部可以访问 Service，很多情况我们也希望应用的 Service 能够暴露给 Cluster 外部。Kubernetes 提供了多种类型的 Service，默认是 ClusterIP。</span></div><p style="margin-bottom: 1.5rem; font-size: 19.2px; line-height: 28.8px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51);"></p><div><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font; font-weight: bold;">ClusterIP</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;-en-paragraph:true;">Service 通过 Cluster 内部的 IP 对外提供服务，只有 Cluster 内的节点和 Pod 可访问，这是默认的 Service 类型，前面实验中的 Service 都是 ClusterIP。</span></div><p style="margin-bottom: 1.5rem; font-size: 19.2px; line-height: 28.8px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51);"></p><div><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font; font-weight: bold;">NodePort</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;-en-paragraph:true;">Service 通过 Cluster 节点的静态端口对外提供服务。Cluster 外部可以通过 </span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;-en-paragraph:true;">&lt;NodeIP&gt;:&lt;NodePort&gt;</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;-en-paragraph:true;"> 访问 Service。</span></div><p style="margin-bottom: 1.5rem; font-size: 19.2px; line-height: 28.8px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51);"></p><div><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font; font-weight: bold;">LoadBalancer</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;-en-paragraph:true;">Service 利用 cloud provider 特有的 load balancer 对外提供服务，cloud provider 负责将 load balancer 的流量导向 Service。目前支持的 cloud provider 有 GCP、AWS、Azur 等。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">下面我们来实践 NodePort，Service </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 的配置文件修改如下：</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image [12].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="221"/></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">添加 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">type: NodePort</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">，重新创建 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc。</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image [13].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="642"/></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">Kubernetes 依然会为 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 分配一个 ClusterIP，不同的是：</span></span></div><ol style="margin-left: 2rem;"><li><div style="margin-bottom: 1.5rem; font-size: 19.2px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">EXTERNAL-IP</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 为 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">none</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">，表示可通过 Cluster 每个节点自身的 IP 访问 Service。</span></div></li><li><div style="margin-bottom: 1.5rem; font-size: 19.2px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">PORT(S)</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 为 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">8080:26044</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">。</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">8080</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 是 ClusterIP 监听的端口，<span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">26044</span></span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 则是节点上监听的端口。Kubernetes 会从 30000-32767 中分配一个可用的端口，每个节点都会监听此端口并将请求转发给 Service。</span></div></li></ol><div style="margin-bottom: 1.5rem; font-size: 19.2px; text-rendering: optimizeLegibility;"><span style="font-size: 19.2px; line-height: 28.8px;"><img src="如何访问pod_files/Image [14].png" type="image/png" data-filename="Image.png" style="font-size: 14pt;" width="642"/></span></div><div style="margin-bottom: 1.5rem; font-size: 19.2px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; line-height: 28.8px;">下面测试 NodePort 是否正常工作。</span></div><div style="margin-bottom: 1.5rem; font-size: 19.2px; text-rendering: optimizeLegibility;"><span style="font-size: 19.2px; line-height: 28.8px;"><img src="如何访问pod_files/Image [15].png" type="image/png" data-filename="Image.png" style="font-size: 14pt;" width="514"/></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">通过两个节点 IP + 26044 端口都能够访问 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">httpd-svc</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">。</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">NodePort 默认是的随机选择，不过我们可以用 </span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;">nodePort</span><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"> 指定某个特定端口。</span></span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image [16].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="249"/></span></span></span></div><div><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;">现在配置文件中就有三个 Port 了：</span></div><div><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;">nodePort</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;"> 是节点上监听的端口。</span></div><div><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;">port</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;"> 是 ClusterIP 上监听的端口。</span></div><div><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;-en-paragraph:true;">targetPort</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system-font;-en-paragraph:true;"> 是 Pod 监听的端口。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility;"><span style="font-size: 16px; text-rendering: optimizeLegibility; color: rgb(51, 51, 51); font-family: -apple-system-font; line-height: 28.8px;"><img src="如何访问pod_files/Image [17].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);"/></span></span></span></div></div><div><br/></div></span>
</div></body></html> 