<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600240 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="791"/>

<div>
<span><div><div style="-evernote-webclip:true;"><div><br/></div><div style="letter-spacing: 0.034em; background-color: rgb(255, 255, 255);"><div style="overflow-wrap:break-word;hyphens:auto;"><div style="background-color:rgb(255, 255, 255);"><div style="overflow: hidden; overflow-wrap: break-word; text-align: justify;"><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div style="text-align: center;"><span style="box-sizing: border-box; letter-spacing: 0.442px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 18.6667px; background-color: rgb(0, 88, 156); color: rgb(255, 255, 255); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-webclip:true;">第五篇</span><span style="box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 16pt; letter-spacing: 0.034em; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-webclip:true;">cinder</span><span style="box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 16pt; letter-spacing: 0.034em; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-webclip:true;">— 存储服务</span></div><div style="text-align: center;"></div><div style="text-align: left;"><span style="box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 16pt; letter-spacing: 0.034em;-evernote-webclip:true;"><span style="letter-spacing: 0.034em; font-size: 14pt; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;-evernote-webclip:true;">一、cinder 介绍：</span></span></div><div style="text-align: left;"><span style="box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 16pt; letter-spacing: 0.034em;-evernote-webclip:true;"><span style="letter-spacing: 0.034em; font-size: 14pt; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;-evernote-webclip:true;"><br/></span></span></div><div style="text-align: left;"></div><div style="text-align: center;"></div><div style="text-align: left;"></div></div><div style="font-size: 17px; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><span style="font-size: 16px; display: inline-block;"><span style="font-size: 17px; box-sizing: border-box; margin: 0px; max-width: 100%; overflow-wrap: break-word; padding: 0px; color: rgb(153, 153, 153); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 25px;">理解 Block Storage</span></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">操作系统获得存储空间的方式一般有两种：</span></div><ol style="font-size: 17px; margin: 0px; padding: 0px 0px 0px 2.2em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">通过某种协议（SAS,SCSI,SAN,iSCSI 等）挂接裸硬盘，然后分区、格式化、创建文件系统；或者直接使用裸硬盘存储数据（数据库）</span></div></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">通过 NFS、CIFS 等 协议，mount 远程的文件系统</span></div><div><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div></div></li></ol><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">第一种裸硬盘的方式叫做 Block Storage（块存储），每个裸硬盘通常也称作 Volume（卷） 第二种叫做文件系统存储。NAS 和 NFS 服务器，以及各种分布式文件系统提供的都是这种存储。</span></div><div><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div></div><div style="font-size: 17px; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><span style="font-size: 17px; box-sizing: border-box; margin: 0px; max-width: 100%; overflow-wrap: break-word; padding: 0px; color: rgb(153, 153, 153); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 25px;">理解 Block Storage Service</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">Block Storage Servicet 提供对 volume 从创建到删除整个生命周期的管理。从 instance 的角度看，挂载的每一个 Volume 都是一块硬盘。OpenStack 提供 Block Storage Service 的是 Cinder，其具体功能是：</span></div><ol style="font-size: 17px; margin: 0px; padding: 0px 0px 0px 2.2em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">提供 REST API 使用户能够查询和管理 volume、volume snapshot 以及 volume type</span></div></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">提供 scheduler 调度 volume 创建请求，合理优化存储资源的分配</span></div></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">通过 driver 架构支持多种 back-end（后端）存储方式，包括 LVM，NFS，Ceph 和其他诸如 EMC、IBM 等商业存储产品和方案</span></div><div><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div></div></li></ol><div style="font-size: 17px; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><span style="font-size: 17px; box-sizing: border-box; margin: 0px; max-width: 100%; overflow-wrap: break-word; padding: 0px; color: rgb(153, 153, 153); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 25px;">Cinder 架构</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">下图是 cinder 的逻辑架构图</span></div><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div style="font-size: 17px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div><div style="font-size: 17px;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;"><img src="cinder_files/640.jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;white-space:normal;float:none;width:321px !important;visibility:visible !important;" title="http://7xo6kd.com1.z0.glb.clouddn.com/upload-ueditor-image-20160610-1465514561994059446.png" width="321"/></span></div><div><b><font style="font-size: 14pt;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></font></b></div></div><div style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;"><b><font style="font-size: 14pt;">Cinder 包含如下几个组件：</font></b></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; letter-spacing: 0.034em;"><br/></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; letter-spacing: 0.034em;">cinder-api</span><br/></div><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">接收 API 请求， <span style="font-family: -apple-system-font; font-size: 13pt; color: rgb(51, 51, 51);"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;-evernote-webclip:true;">调用 cinder-volume 。</span>是整个 Cinder 组件的门户，所有 cinder 的请求都首先由 cinder-api 处理。cinder-api 向外界暴露若干 HTTP REST API 接口。在 keystone 中我们可以查询 cinder-api 的 endponits。</span></span></div></div><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><img src="cinder_files/Image.png" type="image/png" data-filename="Image.png" style="font-size: 13pt;" width="642"/></p><p style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="-en-paragraph:true;"><font style="font-size: 12pt;">客户端可以将请求发送到 endponits 指定的地址，向 cinder-api 请求操作。 当然，作为最终用户的我们不会直接发送 Rest API 请求。OpenStack CLI，Dashboard 和其他需要跟 Cinder 交换的组件会使用这些 API。</font></span></p><div style="font-size: 17px; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 13pt;-en-paragraph:true;">cinder-api 对接收到的 HTTP API 请求会做如下处理：</span></div><div style="font-size: 17px; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 11pt; letter-spacing: 0.034em;">1、检查客户端传人的参数是否合法有效</span></div><div style="font-size: 17px; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 11pt; letter-spacing: 0.034em;">2、调用 cinder 其他子服务的处理客户端请求</span></div><div style="font-size: 17px; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 11pt; letter-spacing: 0.034em;">3、将 cinder 其他子服务返回的结果序列号并返回给客户端</span></div><p style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="-en-paragraph:true;"><font style="font-size: 12pt;">cinder-api 接受哪些请求呢？简单的说，只要是 Volume 生命周期相关的操作，cinder-api 都可以响应。大部分操作都可以在 Dashboard 上看到。</font></span><br/></p><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><br/></p><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><br/></p><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="font-size: 17px; box-sizing: border-box; margin: 0px; max-width: 100%; overflow-wrap: break-word; padding: 0px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">cinder-volume</span></div><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">管理 volume 的服务，与 volume provider 协调工作，管理 volume 的生命周期。运行 cinder-volume 服务的节点被称作为存储节点。</span></div><div><span style="font-family: -apple-system-font; font-size: 13pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: -apple-system-font; font-size: 13pt; color: rgb(51, 51, 51);">cinder-volume 在存储节点上运行，OpenStack 对 Volume 的操作，最后都是交给 cinder-volume 来完成的。cinder-volume 自身并不管理真正的存储设备，存储设备是由</span> <span style="font-family: -apple-system-font; font-size: 13pt;"><font style="color: rgb(255, 0, 0);">volume provider</font></span> <span style="font-family: -apple-system-font; font-size: 13pt; color: rgb(51, 51, 51);">管理的。cinder-volume 与 volume provider 一起实现 volume 生命周期的管理。</span></div></div><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="line-height: 22px; font-size: 16px;-en-paragraph:true;"><br/></span></p><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="line-height: 22px; font-size: 16px;-en-paragraph:true;"><font style="color: rgb(54, 101, 238);"><u><b>通过 Driver 架构支持多种 Volume Provider</b></u></font></span></p><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="line-height: 22px; font-size: 16px;-en-paragraph:true;"><span style="font-size: 12pt;-en-paragraph:true;">接着的问题是：现在市面上有这么多块存储产品和方案（volume provider），cinder-volume 如何与它们配合呢？</span></span></p><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="line-height: 22px; font-size: 16px;-en-paragraph:true;"><span style="font-size: 12pt;-en-paragraph:true;"><br/></span></span></p><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 12pt;-en-paragraph:true;">通过的 Driver 架构。 cinder-volume 为这些 volume provider 定义了统一的接口，volume provider 只需要实现这些接口，就可以 Driver 的形式即插即用到 OpenStack 系统中。</span><span style="line-height: 22px; font-size: 16px; font-weight: bold;-en-paragraph:true;"><br/></span></p><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 12pt;-en-paragraph:true;"><u><font color="#3665EE"><br/></font></u></span></p><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><u><font style="color: rgb(54, 101, 238);"><span style="font-size: 16px; font-weight: bold;">定期向 OpenStack 报告计算节点的状态</span></font></u></p><p style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><font style="font-size: 12pt;"><span style="font-size: 12pt;">cinder-volume 会定期向 Cinder 报告</span>存储节点的空闲容量来做筛选启动volume</font></p><p style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><font style="font-size: 12pt;"><br/></font></p><p style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><font style="font-size: 12pt;"><span style="color: rgb(54, 101, 238); font-size: 16px; font-weight: bold; text-decoration: underline;-evernote-webclip:true;"><span style="font-weight: bold; font-size: 16px; color: rgb(54, 101, 238); text-decoration: underline;">实现 volume 生命周期管理</span></span><br/></font></p><p style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><font style="font-size: 12pt;"><span style="font-size: 12pt;">Cinder 对 volume 的生命周期的管理最终都是通过 cinder-volume 完成的，包括 volume 的 create、extend、attach、snapshot、delete 等。</span><br/></font></p><p style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><font style="font-size: 12pt;"><br/></font></p><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="font-size: 17px; box-sizing: border-box; margin: 0px; max-width: 100%; overflow-wrap: break-word; padding: 0px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">cinder-scheduler</span></div><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">scheduler 通过调度算法选择最合适的存储节点创建 volume。 <span style="font-family: -apple-system-font; font-size: 13pt; color: rgb(51, 51, 51);">创建 Volume 时，cinder-scheduler 会基于容量、Volume Type 等条件选择出最合适的存储节点，然后让其创建 Volume</span></span></div></div><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"></p><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="font-size: 17px; box-sizing: border-box; margin: 0px; max-width: 100%; overflow-wrap: break-word; padding: 0px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">volume provider</span></div><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">数据的存储设备，为 volume 提供物理存储空间。 cinder-volume 支持多种 volume provider，每种 volume provider 通过自己的 driver 与cinder-volume 协调工作。</span></div></div><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"></p><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="font-size: 17px; box-sizing: border-box; margin: 0px; max-width: 100%; overflow-wrap: break-word; padding: 0px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">Message Queue</span></div><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">Cinder 各个子服务通过消息队列实现进程间通信和相互协作。因为有了消息队列，子服务之间实现了解耦，这种松散的结构也是分布式系统的重要特征。</span></div></div><p style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"></p><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; box-sizing: border-box; margin: 0px; max-width: 100%; overflow-wrap: break-word; padding: 0px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 1.6;">Database Cinder </span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">有一些数据需要存放到数据库中，一般使用 MySQL。数据库是安装在控制节点上的，比如在我们的实验环境中，可以访问名称为“cinder”的数据库。</span></div><div><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><img src="cinder_files/Image [1].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 13pt; color: rgb(51, 51, 51);" width="642"/></div><div><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div></div><div style="font-size: 17px; margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><span style="font-size: 17px; box-sizing: border-box; margin: 0px; max-width: 100%; overflow-wrap: break-word; padding: 0px; color: rgb(153, 153, 153); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-weight: bold; line-height: 25px;">物理部署方案</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">Cinder 的服务会部署在两类节点上，控制节点和存储节点。我们来看看控制节点 controller 上都运行了哪些 cinder-* 子服务。</span></div><div><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;"><img src="cinder_files/640.png" type="image/png" data-filename="640.png" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;white-space:normal;float:none;width:365px !important;visibility:visible !important;" title="http://7xo6kd.com1.z0.glb.clouddn.com/upload-ueditor-image-20160610-1465514562079057922.png" width="365"/></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">cinder-api 和 cinder-scheduler 部署在控制节点上，这个很合理。</span></div></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">至于 cinder-volume 也在控制节点上可能有些同学就会迷糊了：cinder-volume 不是应该部署在存储节点上吗？</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">要回答这个问题，首先要搞清楚一个事实： OpenStack 是分布式系统，其每个子服务都可以部署在任何地方，只要网络能够连通。无论是哪个节点，只要上面运行了 cinder-volume，它就是一个存储节点，当然，该节点上也可以运行其他 OpenStack服务。</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">cinder-volume 是一顶存储节点帽子，cinder-api 是一顶控制节点帽子。在我们的环境中，devstack-controller 同时戴上了这两顶帽子，所以它既是控制节点，又是存储节点。当然，我们也可以用一个专门的节点来运行 cinder-volume。</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">这再一次展示了 OpenStack 分布式架构部署上的灵活性： 可以将所有服务都放在一台物理机上，用作一个 All-in-One 的测试环境；而在生产环境中可以将服务部署在多台物理机上，获得更好的性能和高可用。</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">RabbitMQ 和 MySQL 通常放在控制节点上。另外，也可以用 cinder service list 查看 cinder-* 子服务都分布在哪些节点上</span></div><div style="font-size: 17px; margin: 15px 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-width: 0px; border-style: initial; border-color: initial; white-space: pre;"><img src="cinder_files/Image [2].png" type="image/png" data-filename="Image.png" style="font-size: 13pt;" width="642"/><br/></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;"><br/></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">还有一个问题：volume provider 放在那里？</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">一般来讲，volume provider 是独立的。cinder-volume 使用 driver 与 volume provider 通信并协调工作。所以只需要将 driver 与 cinder-volume 放到一起就可以了。在 cinder-volume 的源代码目录下有很多 driver，支持不同的 volume provider。</span></div><div><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;"><br/></span></div></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><img src="cinder_files/Image [3].png" type="image/png" data-filename="Image.png" style="font-size: 13pt;" width="642"/><br/></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 17px; color: rgb(51, 51, 51); font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; line-height: 1.6;">后面我们会以 LVM 和 NFS 这两种 volume provider 为例讨论 cinder-volume 的使用，其他 volume provider 可以查看 OpenStack 的 configuration 文档。</span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><br/></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><br/></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="box-sizing: border-box; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; letter-spacing: 0.034em; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;-evernote-webclip:true;">二、 <span style="font-weight: bold; font-family: -apple-system-font; font-size: 14pt; color: rgb(54, 101, 238);">Cinder 的设计思想</span>：</span></div></div></div></div></div></div><div><br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"/></div><div style="margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><font style="font-size: 12pt; color: rgb(168, 168, 168);"><b>从 volume 创建流程看 cinder-* 子服务如何协同工作</b></font><br/></div><div><span style="font-family: -apple-system-font; font-size: 13pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: -apple-system-font; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">对于 Cinder 学习来说，Volume 创建是一个非常好的场景，涉及各个 cinder-* 子服务，下面是流程图：</font></span></div><div><img src="cinder_files/Image [4].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 13pt; color: rgb(51, 51, 51);" width="304"/></div><ul><li><div>客户（可以是 OpenStack 最终用户，也可以是其他程序）向 API（cinder-api）发送请求：“帮我创建一个 volume”</div><div><br/></div></li><li><div>API 对请求做一些必要处理后，向 Messaging（RabbitMQ）发送了一条消息：“让 Scheduler 创建一个 volume”</div><div><br/></div></li><li><div>Scheduler（cinder-scheduler）从 Messaging 获取到 API 发给它的消息，然后执行调度算法，从若干计存储点中选出节点 A</div><div><br/></div></li><li><div>Scheduler 向 Messaging 发送了一条消息：“让存储节点 A 创建这个 volume”</div><div><br/></div></li><li><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">存储节点 A 的 Volume（cinder-volume）从 Messaging 中获取到 Scheduler 发给它的消息，然后通过 driver 在 volume provider 上创建 volume。</span></div></li></ul><div><br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"/></div><div style="margin: 5px 0px 0px; padding: 10px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; border-style: none none none solid; border-color: rgb(0, 88, 156); box-shadow: rgb(153, 153, 153) 1px 1px 2px; border-left-width: 10px; background-color: rgb(243, 243, 243);"><span style="font-weight: bold;"><font style="font-size: 12pt; color: rgb(168, 168, 168);">Cinder 的设计思想</font></span><br/></div><div><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;">Cinder 延续了 Nova 的以及其他组件的设计思想。</span></div><div style="line-height: 22px; font-size: 18px; margin-top: 1em; margin-bottom: 1em;"><span style="line-height: 22px; font-size: 18px; font-weight: bold; font-family: -apple-system-font; color: rgb(51, 51, 51);-en-paragraph:true;">API 前端服</span><span style="line-height: 22px; font-size: 18px; font-family: -apple-system-font; color: rgb(51, 51, 51);-en-paragraph:true;">务</span></div><div><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);">cinder-api 作为 Cinder 组件对外的唯一窗口，向客户暴露 Cinder 能够提供的功能，当客户需要执行 volume 相关的操作，能且只能向 cinder-api 发送 REST 请求。这里的客户包括终端用户、命令行和 OpenStack 其他组件。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;">设计 API 前端服务的好处在于：</span></div><ol><li><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;">对外提供统一接口，隐藏实现细节</span></div></li><li><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;">API 提供 REST 标准调用服务，便于与第三方系统集成</span></div></li><li><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;">可以通过运行多个 API 服务实例轻松实现 API 的高可用，比如运行多个 cinder-api 进程</span></div></li></ol><div style="line-height: 22px; font-size: 18px; margin-top: 1em; margin-bottom: 1em;"><span style="line-height: 22px; font-size: 18px; font-weight: bold; font-family: -apple-system-font; color: rgb(51, 51, 51);-en-paragraph:true;">Scheduler 调度服务</span></div><div><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);">Cinder 可以有多个存储节点，当需要创建 volume 时，cinder-scheduler 会根据</span><span style="font-family: -apple-system-font; font-size: 12pt;"><font style="color: rgb(255, 0, 0);">存储节点的属性和资源使用</font></span><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);">情况选择一个最合适的节点来创建 volume。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;">调度服务就好比是一个开发团队中的项目经理，当接到新的开发任务时，项目经理会根据任务的难度，每个团队成员目前的工作负荷和技能水平，将任务分配给最合适的开发人员。</span></div><div style="line-height: 22px; font-size: 18px; margin-top: 1em; margin-bottom: 1em;"><span style="line-height: 22px; font-size: 18px; font-weight: bold; font-family: -apple-system-font; color: rgb(51, 51, 51);-en-paragraph:true;">Worker 工作服务</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;">调度服务只管分配任务，真正执行任务的是 Worker 工作服务。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;">在 Cinder 中，这个 Worker 就是 cinder-volume 了。这种 Scheduler 和 Worker 之间职能上的划分使得 OpenStack 非常容易扩展：当存储资源不够时可以增加存储节点（增加 Worker）。 当客户的请求量太大调度不过来时，可以增加 Scheduler。</span></div><div style="line-height: 22px; font-size: 18px; margin-top: 1em; margin-bottom: 1em;"><span style="line-height: 22px; font-size: 18px; font-weight: bold; font-family: -apple-system-font; color: rgb(51, 51, 51);-en-paragraph:true;">Driver 框架</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;">OpenStack 作为开放的 Infrastracture as a Service 云操作系统，支持业界各种优秀的技术，这些技术可能是开源免费的，也可能是商业收费的。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;">这种开放的架构使得 OpenStack 保持技术上的先进性，具有很强的竞争力，同时又不会造成厂商锁定（Lock-in）。 那 OpenStack 的这种开放性体现在哪里呢？一个重要的方面就是采用基于 Driver 的框架。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;">以 Cinder 为例，存储节点支持多种 volume provider，包括 LVM, NFS, Ceph, GlusterFS，以及 EMC, IBM 等商业存储系统。 cinder-volume 为这些 volume provider 定义了统一的 driver 接口，volume provider 只需要实现这些接口，就可以 driver 的形式即插即用到 OpenStack 中。下面是 cinder driver 的架构示意图：</span><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;"><img src="cinder_files/Image [5].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="607"/><br/></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);">在 cinder-volume 的配置文件 /etc/cinder/cinder.conf 中 volume_driver 配置项设置该存储节点使用哪种 volume provider 的 driver，下面的示例表示使用的是 LVM。</span><br/></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);"><img src="cinder_files/Image [6].png" type="image/png" data-filename="Image.png" style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);" width="461"/><br/></span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="overflow-wrap:break-word;hyphens:auto;"><div style="background-color:rgb(255, 255, 255);"><div style="overflow: hidden; overflow-wrap: break-word; text-align: justify;"><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-family: -apple-system-font; font-size: 12pt; color: rgb(51, 51, 51);-en-paragraph:true;"><span style="font-size: 14pt; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;-evernote-webclip:true;"><br/></span></span></div><div style="font-size: 17px; margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word;"><span style="font-size: 14pt; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;-evernote-webclip:true;">三、</span> <span style="font-size: 14pt; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;-evernote-webclip:true;">Cinder 的配置文件</span><span style="font-size: 14pt; clear: both; min-height: 1em; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; letter-spacing: 0.034em; color: rgb(54, 101, 238); font-family: -apple-system-font; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;-evernote-webclip:true;">：</span></div></div></div></div></div><div>vim /etc/cinder/cinder.conf</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[DEFAULT]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">my_ip = 172.16.254.63</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">glance_api_servers =</span> <a href="http://controller:9292/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://controller:9292</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">auth_strategy = keystone</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">enabled_backends = lvm</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">transport_url =</span> <a href="rabbit://openstack:admin@controller/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">rabbit://openstack:admin@controller</a></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[backend]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[barbican]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[brcd_fabric_example]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[cisco_fabric_example]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[coordination]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[cors]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[cors.subdomain]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[database]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">connection = mysql+</span><a href="pymysql://cinder:CINDER_DBPASS@controller/cinder" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">pymysql://cinder:CINDER_DBPASS@controller/cinder</a></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[fc-zone-manager]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[healthcheck]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[key_manager]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[keystone_authtoken]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">auth_uri =</span> <a href="http://controller:5000/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://controller:5000</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">auth_url =</span> <a href="http://controller:35357/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://controller:35357</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">memcached_servers = controller:11211</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">auth_type = password</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">project_domain_name = default</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">user_domain_name = default</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">project_name = service</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">username = cinder</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">password = cinder</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[matchmaker_redis]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[oslo_concurrency]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">lock_path = /var/lib/cinder/tmp</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[oslo_messaging_amqp]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[oslo_messaging_kafka]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[oslo_messaging_notifications]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[oslo_messaging_rabbit]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[oslo_messaging_zmq]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[oslo_middleware]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[oslo_policy]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[oslo_reports]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[oslo_versionedobjects]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[profiler]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[ssl]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[lvm]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">volume_group = cinder-vg</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">volumes_dir = $state_path/volumes</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">iscsi_protocol = iscsi</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">iscsi_helper = lioadm</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">iscsi_ip_address = 172.16.254.63</span></div></div></div></span>
</div></body></html> 